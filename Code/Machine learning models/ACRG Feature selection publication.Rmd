---
title: "ACRG feature selection"
author: "Daniel Skubleny"
date: "23/02/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Set our data up
Need to reduce dataset to common genes
```{r}
dim(log_ACRG)
```
```{r}
edata_ACRG <- subset(log_ACRG, rownames(log_ACRG) %in% as.matrix(commongenes))
```

Need to set up transpose edata_ACRG and make subtype a column. 
```{r}
options(timeout=999)
#Need to retreive subtype and tumour id corresponding to GSM number
ACRG_GEO = getGEO('GSE62254')
pheno_ACRG_GEO = as.data.frame(ACRG_GEO[["GSE62254_series_matrix.txt.gz"]]@phenoData@data)
```
```{r}
pheno_ACRG_GEOsubset = dplyr::select(pheno_ACRG_GEO, c("geo_accession","patient:ch1"))
```

```{r}
#Change column names
pheno_ACRGsubset = dplyr::select(pheno_ACRG, c("Tumor ID","Mol. Subtype: 0=MSS/TP53-, 1=MSS/TP53+, 2 = MSI, 3= EMT"))
colnames(pheno_ACRGsubset)[which(names(pheno_ACRGsubset) == "Mol. Subtype: 0=MSS/TP53-, 1=MSS/TP53+, 2 = MSI, 3= EMT")] <- "Subtype" #Convert column name
colnames(pheno_ACRG_GEOsubset)[which(names(pheno_ACRG_GEOsubset) == "patient:ch1")] <- "Tumor ID" #Convert column name
```
#Merge subtype and tumor ID to GSM followed by merging the GSM Ids to edata
```{r}
pheno_ACRGmerge = merge(pheno_ACRG_GEOsubset,pheno_ACRGsubset, by.x="Tumor ID")
```
```{r}
#Transpose data and make Sample Id a column to merge with subtype
tedata_ACRG = as.data.frame(t(edata_ACRG))
subtype_ACRG = tedata_ACRG 
```
```{r}
subtype_ACRG = tibble::rownames_to_column(subtype_ACRG, "geo_accession")
subtype_ACRG = merge(pheno_ACRGmerge,subtype_ACRG, by.x="geo_accession")
subtype_ACRG = subtype_ACRG %>% tibble::column_to_rownames("geo_accession") # Make the first column the row name
subtype_ACRG = dplyr::select(subtype_ACRG, c(-"Tumor ID")) #Remove Tumour ID column 
```
#Change subtypes to category name
```{r}
subtype_ACRG$Subtype = as.factor(subtype_ACRG$Subtype)
#Change category level names to ACRG subtype names
subtype_ACRG <- subtype_ACRG %>% mutate(Subtype = recode(Subtype, "0" = "MSS_TP53neg","1" = "MSS_TP53pos","2" = "MSI", "3" = "EMT"))
```

### THIS IS WHERE I NEED TO ESTABLISH MY NESTED CV. 

```{r}
subtype_ACRG = as.data.frame(subtype_ACRG)
#Create 80/20% data split at random

#Convert numeric columns to numeric
subtype_ACRG[,2:ncol(subtype_ACRG)] = lapply(2:ncol(subtype_ACRG),function(x) as.numeric(subtype_ACRG[[x]]))
```
```{r}
set.seed(99)
trainRowNumbers_ACRG = createDataPartition(subtype_ACRG$Subtype, p=0.8,list=FALSE,times = 10)
trainRowNumbers_ACRG = as.data.frame(trainRowNumbers_ACRG)
```

#/////CV fold 1 for lasso features/////

```{r}
trainData_ACRG1 = subtype_ACRG[trainRowNumbers_ACRG$Resample01,]
testData_ACRG1 = subtype_ACRG[-trainRowNumbers_ACRG$Resample01,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG1[, 2:9285])
y= trainData_ACRG1$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG1[, 2:9285])
y.test = testData_ACRG1$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model1 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso1 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso1
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull1 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull1
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG1 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG1 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model1 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG1 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG1
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso1 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso1
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model1 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG1 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso1 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso1
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model1 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG1 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso1 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso1
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model1 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG1 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso1 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso1
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model1 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG1 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso1 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso1
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model1 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG1 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso1 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso1
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model1 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG1 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso1 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso1
```



#/////CV fold 2 for lasso features/////

```{r}
trainData_ACRG2 = subtype_ACRG[trainRowNumbers_ACRG$Resample02,]
testData_ACRG2 = subtype_ACRG[-trainRowNumbers_ACRG$Resample02,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG2[, 2:9285])
y= trainData_ACRG2$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG2[, 2:9285])
y.test = testData_ACRG2$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model2 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso2 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso2
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull2 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull2
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG2 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG2 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model2 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG2 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG2
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso2 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso2
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model2 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG2 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso2 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso2
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model2 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG2 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso2 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso2
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model2 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG2 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso2 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso2
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model2 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG2 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso2 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso2
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model2 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG2 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso2 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso2
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model2 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG2 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso2 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso2
```


#/////CV fold 3 for lasso features/////

```{r}
trainData_ACRG3 = subtype_ACRG[trainRowNumbers_ACRG$Resample03,]
testData_ACRG3 = subtype_ACRG[-trainRowNumbers_ACRG$Resample03,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG3[, 2:9285])
y= trainData_ACRG3$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG3[, 2:9285])
y.test = testData_ACRG3$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model3 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso3 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso3
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull3 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull3
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG3 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG3 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model3 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG3 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG3
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso3 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso3
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model3 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG3 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso3 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso3
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model3 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG3 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso3 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso3
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model3 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG3 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso3 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso3
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model3 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG3 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso3 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso3
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model3 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG3 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso3 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso3
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model3 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG3 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso3 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso3
```



#/////CV fold 4 for lasso features/////

```{r}
trainData_ACRG4 = subtype_ACRG[trainRowNumbers_ACRG$Resample04,]
testData_ACRG4 = subtype_ACRG[-trainRowNumbers_ACRG$Resample04,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG4[, 2:9285])
y= trainData_ACRG4$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG4[, 2:9285])
y.test = testData_ACRG4$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model4 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso4 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso4
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull4 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull4
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG4 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG4 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model4 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG4 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG4
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso4 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso4
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model4 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG4 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso4 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso4
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model4 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG4 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso4 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso4
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model4 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG4 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso4 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso4
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model4 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG4 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso4 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso4
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model4 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG4 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso4 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso4
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model4 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG4 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso4 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso4
```



#/////CV fold 5 for lasso features/////

```{r}
trainData_ACRG5 = subtype_ACRG[trainRowNumbers_ACRG$Resample05,]
testData_ACRG5 = subtype_ACRG[-trainRowNumbers_ACRG$Resample05,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG5[, 2:9285])
y= trainData_ACRG5$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG5[, 2:9285])
y.test = testData_ACRG5$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model5 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso5 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso5
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull5 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull5
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG5 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG5 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model5 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG5 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG5
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso5 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso5
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model5 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG5 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso5 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso5
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model5 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG5 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso5 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso5
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model5 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG5 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso5 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso5
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model5 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG5 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso5 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso5
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model5 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG5 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso5 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso5
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model5 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG5 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso5 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso5
```


#/////CV fold 6 for lasso features/////

```{r}
trainData_ACRG6 = subtype_ACRG[trainRowNumbers_ACRG$Resample06,]
testData_ACRG6 = subtype_ACRG[-trainRowNumbers_ACRG$Resample06,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG6[, 2:9285])
y= trainData_ACRG6$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG6[, 2:9285])
y.test = testData_ACRG6$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model6 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso6 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso6
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull6 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull6
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG6 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG6 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model6 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG6 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG6
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso6 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso6
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model6 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG6 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso6 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso6
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model6 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG6 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso6 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso6
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model6 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG6 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso6 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso6
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model6 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG6 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso6 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso6
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model6 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG6 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso6 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso6
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model6 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG6 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso6 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso6
```


#/////CV fold 7 for lasso features/////

```{r}
trainData_ACRG7 = subtype_ACRG[trainRowNumbers_ACRG$Resample07,]
testData_ACRG7 = subtype_ACRG[-trainRowNumbers_ACRG$Resample07,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG7[, 2:9285])
y= trainData_ACRG7$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG7[, 2:9285])
y.test = testData_ACRG7$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model7 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso7 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso7
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull7 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull7
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG7 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG7 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model7 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG7 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG7
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso7 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso7
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model7 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG7 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso7 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso7
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model7 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG7 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso7 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso7
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model7 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG7 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso7 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso7
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model7 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG7 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso7 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso7
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model7 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG7 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso7 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso7
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model7 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG7 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso7 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso7
```


#/////CV fold 8 for lasso features/////

```{r}
trainData_ACRG8 = subtype_ACRG[trainRowNumbers_ACRG$Resample08,]
testData_ACRG8 = subtype_ACRG[-trainRowNumbers_ACRG$Resample08,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG8[, 2:9285])
y= trainData_ACRG8$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG8[, 2:9285])
y.test = testData_ACRG8$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model8 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso8 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso8
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull8 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull8
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG8 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG8 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model8 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG8 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG8
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso8 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso8
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model8 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG8 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso8 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso8
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model8 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG8 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso8 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso8
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model8 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG8 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso8 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso8
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model8 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG8 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso8 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso8
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model8 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG8 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso8 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso8
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model8 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG8 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso8 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso8
```


#/////CV fold 9 for lasso features/////

```{r}
trainData_ACRG9 = subtype_ACRG[trainRowNumbers_ACRG$Resample09,]
testData_ACRG9 = subtype_ACRG[-trainRowNumbers_ACRG$Resample09,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG9[, 2:9285])
y= trainData_ACRG9$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG9[, 2:9285])
y.test = testData_ACRG9$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model9 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso9 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso9
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull9 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull9
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG9 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG9 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model9 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG9 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG9
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso9 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso9
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model9 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG9 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso9 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso9
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model9 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG9 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso9 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso9
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model9 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG9 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso9 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso9
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model9 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG9 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso9 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso9
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model9 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG9 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso9 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso9
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model9 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG9 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso9 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso9
```


#/////CV fold 10 for lasso features/////

```{r}
trainData_ACRG10 = subtype_ACRG[trainRowNumbers_ACRG$Resample10,]
testData_ACRG10 = subtype_ACRG[-trainRowNumbers_ACRG$Resample10,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG10[, 2:9285])
y= trainData_ACRG10$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG10[, 2:9285])
y.test = testData_ACRG10$Subtype
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.ACRG.model10 = lasso.10fold
predict.lasso.ACRG = predict(lasso.10fold,x.test, type="class")
u = union(predict.lasso.ACRG, y.test)
table.lasso.ACRG <- table(factor(predict.lasso.ACRG, u), factor(y.test, u))
full.ACRG.lasso10 = confusionMatrix(table.lasso.ACRG)
full.ACRG.lasso10
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG = predict(lasso.10fold, x.test, type="response")
brier.lasso.ACRG = (brier.lasso.ACRG)/rowSums(brier.lasso.ACRG)
brier.lasso.ACRGfull10 = multiclass.Brier(brier.lasso.ACRG,y.test)
brier.lasso.ACRGfull10
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoACRG10 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["MSS_TP53neg"]]@i,coef.lasso.10fold[["MSS_TP53pos"]]@i,coef.lasso.10fold[["MSI"]]@i,coef.lasso.10fold[["EMT"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testACRG10 = x.lasso.test
```
#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso.ACRG = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.ACRG.model10 = lasso.lasso.ACRG
predict.lasso.lasso.ACRG = predict(lasso.lasso.ACRG,x.lasso.test)
table.lasso.lasso.ACRG = table(predict.lasso.lasso.ACRG,y.test)
lasso.lasso.ACRG10 = confusionMatrix(table.lasso.lasso.ACRG, mode = "everything")
lasso.lasso.ACRG10
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.lasso = predict(lasso.lasso.ACRG, x.lasso.test, type="prob")
brier.lasso.ACRG.lasso = (brier.lasso.ACRG.lasso)/rowSums(brier.lasso.ACRG.lasso)
brier.lasso.ACRG.lasso10 = multiclass.Brier(brier.lasso.ACRG.lasso,y.test)
brier.lasso.ACRG.lasso10
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso.ACRG = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.ACRG.model10 = nb.lasso
predict.nb.lasso.ACRG = predict(nb.lasso.ACRG$finalModel,x.lasso.test)
table.nb.lasso.ACRG = table(predict.nb.lasso.ACRG,y.test)
nb.lasso.ACRG10 = confusionMatrix(table.nb.lasso.ACRG)
nb.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.lasso = predict(nb.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nb.ACRG.lasso = (brier.nb.ACRG.lasso)/rowSums(brier.nb.ACRG.lasso)
brier.nb.ACRG.lasso10 = multiclass.Brier(brier.nb.ACRG.lasso,y.test)
brier.nb.ACRG.lasso10
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso.ACRG = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.ACRG.model10 = rf.lasso
predict.rf.lasso.ACRG = predict(rf.lasso.ACRG,x.lasso.test)
table.rf.lasso.ACRG = table(predict.rf.lasso.ACRG,y.test)
rf.lasso.ACRG10 = confusionMatrix(table.rf.lasso.ACRG)
rf.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.lasso = predict(rf.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.rf.ACRG.lasso = (brier.rf.ACRG.lasso)/rowSums(brier.rf.ACRG.lasso)
brier.rf.ACRG.lasso10 = multiclass.Brier(brier.rf.ACRG.lasso,y.test)
brier.rf.ACRG.lasso10
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso.ACRG = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.ACRG.model10 = gbm.lasso
predict.gbm.lasso.ACRG = predict(gbm.lasso.ACRG,x.lasso.test)
table.gbm.lasso.ACRG = table(predict.gbm.lasso.ACRG,y.test)
gbm.lasso.ACRG10 = confusionMatrix(table.gbm.lasso.ACRG)
gbm.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.lasso = predict(gbm.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.gbm.ACRG.lasso = (brier.gbm.ACRG.lasso)/rowSums(brier.gbm.ACRG.lasso)
brier.gbm.ACRG.lasso10 = multiclass.Brier(brier.gbm.ACRG.lasso,y.test)
brier.gbm.ACRG.lasso10
```

#KNN
```{r}
set.seed(99)
knn.lasso.ACRG = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.ACRG.model10 = knn.lasso
predict.knn.lasso.ACRG = predict(knn.lasso.ACRG,x.lasso.test)
table.knn.lasso.ACRG = table(predict.knn.lasso.ACRG,y.test)
knn.lasso.ACRG10 = confusionMatrix(table.knn.lasso.ACRG)
knn.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.lasso = predict(knn.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.knn.ACRG.lasso = (brier.knn.ACRG.lasso)/rowSums(brier.knn.ACRG.lasso)
brier.knn.ACRG.lasso10 = multiclass.Brier(brier.knn.ACRG.lasso,y.test)
brier.knn.ACRG.lasso10
```

#SVM
```{r}
set.seed(99)
svm.lasso.ACRG = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.ACRG.model10 = svm.lasso
predict.svm.lasso.ACRG = predict(svm.lasso.ACRG,x.lasso.test)
table.svm.lasso.ACRG = table(predict.svm.lasso.ACRG,y.test)
svm.lasso.ACRG10 = confusionMatrix(table.svm.lasso.ACRG)
svm.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.lasso = predict(svm.lasso.ACRG,newdata = x.lasso.test, type = "prob")
brier.svm.ACRG.lasso = (brier.svm.ACRG.lasso)/rowSums(brier.svm.ACRG.lasso)
brier.svm.ACRG.lasso10 = multiclass.Brier(brier.svm.ACRG.lasso,y.test)
brier.svm.ACRG.lasso10
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso.ACRG = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.ACRG.model10 = nnet.lasso
predict.nnet.lasso.ACRG = predict(nnet.lasso.ACRG,x.lasso.test)
table.nnet.lasso.ACRG = table(predict.nnet.lasso.ACRG,y.test)
nnet.lasso.ACRG10 = confusionMatrix(table.nnet.lasso.ACRG)
nnet.lasso.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.lasso = predict(nnet.lasso.ACRG,newdata = x.lasso.test, type="prob")
brier.nnet.ACRG.lasso = (brier.nnet.ACRG.lasso)/rowSums(brier.nnet.ACRG.lasso)
brier.nnet.ACRG.lasso10 = multiclass.Brier(brier.nnet.ACRG.lasso,y.test)
brier.nnet.ACRG.lasso10
```

#END LASSO FEATURES 
#START GBM FEATURES

#/////GBM 1 CV fold for GBM features/////
```{r}
trainData_ACRG1 = subtype_ACRG[trainRowNumbers_ACRG$Resample01,]
testData_ACRG1 = subtype_ACRG[-trainRowNumbers_ACRG$Resample01,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG1[, 2:9285])
y= trainData_ACRG1$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG1[, 2:9285])
y.test = testData_ACRG1$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model1 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG1 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG1
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG1 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG1
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top501 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train1 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test1 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model1 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG1 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG1
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG.model1, gbm.ACRG.test1, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG1 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG1
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model1 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG1 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG1 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG1
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model1 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG1 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG1 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG1
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model1 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG1 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG1 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG1
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model1 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG1 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG1 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG1
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train1,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model1 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test1)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG1 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test1, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG1 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG1
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model1 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG1 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG1 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG1
```


#/////GBM 2 CV fold for GBM features/////
```{r}
trainData_ACRG2 = subtype_ACRG[trainRowNumbers_ACRG$Resample02,]
testData_ACRG2 = subtype_ACRG[-trainRowNumbers_ACRG$Resample02,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG2[, 2:9285])
y= trainData_ACRG2$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG2[, 2:9285])
y.test = testData_ACRG2$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model2 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG2 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG2
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG2 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG2
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top502 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train2 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test2 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model2 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG2 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG2
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG2 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG2
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model2 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG2 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG2 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG2
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model2 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG2 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG2 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG2
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model2 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG2 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG2 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG2
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model2 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG2 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG2 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG2
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train2,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model2 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test2)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG2 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test2, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG2 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG2
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model2 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG2 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG2 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG2
```

#/////GBM 3 CV foldfor GBM features/////
```{r}
trainData_ACRG3 = subtype_ACRG[trainRowNumbers_ACRG$Resample03,]
testData_ACRG3 = subtype_ACRG[-trainRowNumbers_ACRG$Resample03,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG3[, 2:9285])
y= trainData_ACRG3$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG3[, 2:9285])
y.test = testData_ACRG3$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model3 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG3 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG10
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG3 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG3
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top503 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train3 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test3 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model3 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG3 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG3
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG3 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG3
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model3 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG3 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG3 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG3
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model3 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG3 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG3 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG3
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model3 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG3 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG3 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG3
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model3 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG3 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG3 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG3
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train3,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model3 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test3)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG3 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test3, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG3 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG3
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model3 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG3 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG3 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG3
```

#/////GBM CV fold 4 for GBM features/////
```{r}
trainData_ACRG4 = subtype_ACRG[trainRowNumbers_ACRG$Resample04,]
testData_ACRG4 = subtype_ACRG[-trainRowNumbers_ACRG$Resample04,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG4[, 2:9285])
y= trainData_ACRG4$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG4[, 2:9285])
y.test = testData_ACRG4$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model4 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG4 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG4
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG4 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG4
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top504 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train4 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test4 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model4 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG4 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG4
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG4 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG4
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model4 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG4 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG4 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG4
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model4 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG4 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG4 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG4
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model4 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG4 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG4 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG4
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model4 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG4 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG4 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG4
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train4,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model4 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test4)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG4 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test4, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG4 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG4
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model4 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG4 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG4 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG4
```

#/////GBM CV fold 5 for GBM features/////
```{r}
trainData_ACRG5 = subtype_ACRG[trainRowNumbers_ACRG$Resample05,]
testData_ACRG5 = subtype_ACRG[-trainRowNumbers_ACRG$Resample05,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG5[, 2:9285])
y= trainData_ACRG5$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG5[, 2:9285])
y.test = testData_ACRG5$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model5 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG5 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG5
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG5 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG5
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top505 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train5 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test5 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model5 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG5 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG5
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG.model5, gbm.ACRG.test5, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG5 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG5
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model5 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG5 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG5 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG5
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model5 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG5 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG5 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG5
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model5 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG5 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG5 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG5
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model5 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG5 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG5 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG5
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train5,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model5 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test5)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG5 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test5, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG5 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG5
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model5 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG5 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG5 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG5
```

#/////GBM CV fold 6 for GBM features/////
```{r}
trainData_ACRG6 = subtype_ACRG[trainRowNumbers_ACRG$Resample06,]
testData_ACRG6 = subtype_ACRG[-trainRowNumbers_ACRG$Resample06,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG6[, 2:9285])
y= trainData_ACRG6$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG6[, 2:9285])
y.test = testData_ACRG6$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model6 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG6 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG6
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG6 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG6
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top506 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train6 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test6 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model6 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG6 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG6
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG6 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG6
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model6 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG6 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG6 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG6
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model6 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG6 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG6 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG6
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model6 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG6 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG6 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG6
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model6 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG6 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG6 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG6
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train6,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model6 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test6)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG6 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test6, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG6 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG6
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model6 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG6 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG6 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG6
```

#/////GBM CV fold 7 for GBM features/////
```{r}
trainData_ACRG7 = subtype_ACRG[trainRowNumbers_ACRG$Resample07,]
testData_ACRG7 = subtype_ACRG[-trainRowNumbers_ACRG$Resample07,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG7[, 2:9285])
y= trainData_ACRG7$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG7[, 2:9285])
y.test = testData_ACRG7$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model7 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG7 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG7
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG7 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG7
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top507 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train7 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test7 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model7 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG7 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG7
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG7 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG7
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model7 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG7 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG7 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG7
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model7 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG7 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG7 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG7
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model7 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG7 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG7 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG7
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model7 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG7 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG7 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG7
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train7,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model7 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test7)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG7 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test7, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG7 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG7
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model7 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG7 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG7 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG7
```

#/////GBM CV fold 8 for GBM features/////
```{r}
trainData_ACRG8 = subtype_ACRG[trainRowNumbers_ACRG$Resample08,]
testData_ACRG8 = subtype_ACRG[-trainRowNumbers_ACRG$Resample08,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG8[, 2:9285])
y= trainData_ACRG8$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG8[, 2:9285])
y.test = testData_ACRG8$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model8 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG8 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG8
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG8 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG8
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top508 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train8 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test8 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model8 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG8 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG8
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG8 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG8
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model8 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG8 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG8 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG8
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model8 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG8 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG8 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG8
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model8 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG8 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG8 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG8
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model8 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG8 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG8 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG8
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train8,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model8 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test8)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG8 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test8, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG8 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG8
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model8 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG8 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG8 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG8
```

#/////GBM CV fold 9 for GBM features/////
```{r}
trainData_ACRG9 = subtype_ACRG[trainRowNumbers_ACRG$Resample09,]
testData_ACRG9 = subtype_ACRG[-trainRowNumbers_ACRG$Resample09,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG9[, 2:9285])
y= trainData_ACRG9$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG9[, 2:9285])
y.test = testData_ACRG9$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model9 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG9 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG9
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG9 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG9
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top509 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train9 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test9 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model9 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG9 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG9
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG9 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG9
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model9 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG9 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG9 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG9
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model9 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG9 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG9 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG9
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model9 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG9 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG9 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG9
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model19 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG9 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG9 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG9
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train9,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model9 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test9)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG9 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test9, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG9 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG9
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model9 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG9 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG9 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG9
```

#/////GBM CV fold 10 for GBM features/////
```{r}
trainData_ACRG10 = subtype_ACRG[trainRowNumbers_ACRG$Resample10,]
testData_ACRG10 = subtype_ACRG[-trainRowNumbers_ACRG$Resample10,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG10[, 2:9285])
y= trainData_ACRG10$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG10[, 2:9285])
y.test = testData_ACRG10$Subtype
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.ACRG = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.ACRG.model10 = gbm.ACRG
predict.gbm.ACRG = predict(gbm.ACRG, newdata = x.test)
table.gbm.ACRG = table(predict.gbm.ACRG, y.test)
full.gbm.ACRG10 = confusionMatrix(table.gbm.ACRG)
full.gbm.ACRG10
```
```{r}
#Brier Score
brier.gbm.ACRG = predict(gbm.ACRG, newdata = x.test, type="prob")
brier.gbm.ACRG = brier.gbm.ACRG/rowSums(brier.gbm.ACRG)
brier.gbm.ACRG10 = multiclass.Brier(brier.gbm.ACRG,y.test)
brier.gbm.ACRG10
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features_ACRG = varImp(gbm.ACRG)

gbm.ACRG.top50 = gbm_features_ACRG$importance %>% filter(rank(desc(gbm_features_ACRG$importance))<=50)
gbm.ACRG.top5010 = gbm.ACRG.top50
```

```{r}
plot(gbm_features_ACRG, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbm.ACRG.top50)

gbm.ACRG.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.ACRG.train10 = gbm.ACRG.train

gbm.ACRG.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.ACRG.test10 = gbm.ACRG.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm.ACRG = caret::train(gbm.ACRG.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.ACRG.model10 = lasso.gbm.ACRG
predict.lasso.gbm.ACRG = predict(lasso.gbm.ACRG,gbm.ACRG.test)
table.lasso.gbm.ACRG = table(predict.lasso.gbm.ACRG,y.test)
lasso.gbm.ACRG10 = confusionMatrix(table.lasso.gbm.ACRG, mode = "everything")
lasso.gbm.ACRG10
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm.ACRG = predict(lasso.gbm.ACRG, gbm.ACRG.test, type="prob")
brier.lasso.gbm.ACRG = (brier.lasso.gbm.ACRG)/rowSums(brier.lasso.gbm.ACRG)
brier.lasso.gbm.ACRG10 = multiclass.Brier(brier.lasso.gbm.ACRG,y.test)
brier.lasso.gbm.ACRG10
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm.ACRG = caret::train(gbm.ACRG.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.ACRG.model10 = nb.gbm.ACRG
predict.nb.gbm.ACRG = predict(nb.gbm.ACRG,gbm.ACRG.test)
table.nb.gbm.ACRG = table(predict.nb.gbm.ACRG,y.test)
nb.gbm.ACRG10 = confusionMatrix(table.nb.gbm.ACRG)
nb.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm.ACRG = predict(nb.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.nb.gbm.ACRG = (brier.nb.gbm.ACRG)/rowSums(brier.nb.gbm.ACRG)
brier.nb.gbm.ACRG10 = multiclass.Brier(brier.nb.gbm.ACRG,y.test)
brier.nb.gbm.ACRG10
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm.ACRG = caret::train(gbm.ACRG.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.ACRG.model10 = rf.gbm.ACRG
predict.rf.gbm.ACRG = predict(rf.gbm.ACRG,gbm.ACRG.test)
table.rf.gbm.ACRG = table(predict.rf.gbm.ACRG,y.test)
rf.gbm.ACRG10 = confusionMatrix(table.rf.gbm.ACRG)
rf.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm.ACRG = predict(rf.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.rf.gbm.ACRG = (brier.rf.gbm.ACRG)/rowSums(brier.rf.gbm.ACRG)
brier.rf.gbm.ACRG10 = multiclass.Brier(brier.rf.gbm.ACRG,y.test)
brier.rf.gbm.ACRG10
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm.ACRG = caret::train(gbm.ACRG.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.ACRG.model10 = gbm.gbm.ACRG
predict.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,gbm.ACRG.test)
table.gbm.gbm.ACRG = table(predict.gbm.gbm.ACRG,y.test)
gbm.gbm.ACRG10 = confusionMatrix(table.gbm.gbm.ACRG)
gbm.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm.ACRG = predict(gbm.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.gbm.gbm.ACRG = (brier.gbm.gbm.ACRG)/rowSums(brier.gbm.gbm.ACRG)
brier.gbm.gbm.ACRG10 = multiclass.Brier(brier.gbm.gbm.ACRG,y.test)
brier.gbm.gbm.ACRG10
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm.ACRG = caret::train(gbm.ACRG.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.ACRG.model10 = knn.gbm.ACRG 
predict.knn.gbm.ACRG = predict(knn.gbm.ACRG,gbm.ACRG.test)
table.knn.gbm.ACRG = table(predict.knn.gbm.ACRG,y.test)
knn.gbm.ACRG10 = confusionMatrix(table.knn.gbm.ACRG)
knn.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm.ACRG = predict(knn.gbm.ACRG,newdata = gbm.ACRG.test, type="prob")
brier.knn.gbm.ACRG = (brier.knn.gbm.ACRG)/rowSums(brier.knn.gbm.ACRG)
brier.knn.gbm.ACRG10 = multiclass.Brier(brier.knn.gbm.ACRG,y.test)
brier.knn.gbm.ACRG10
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm.ACRG = caret::train(gbm.ACRG.train10,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.gbm.ACRG.model10 = svm.gbm.ACRG
predict.svm.gbm.ACRG = predict(svm.gbm.ACRG,gbm.ACRG.test10)
table.svm.gbm.ACRG = table(predict.svm.gbm.ACRG,y.test)
svm.gbm.ACRG10 = confusionMatrix(table.svm.gbm.ACRG)
svm.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm.ACRG = predict(svm.gbm.ACRG,newdata = gbm.ACRG.test10, type="prob")
brier.svm.gbm.ACRG = (brier.svm.gbm.ACRG)/rowSums(brier.svm.gbm.ACRG)
brier.svm.gbm.ACRG10 = multiclass.Brier(brier.svm.gbm.ACRG,y.test)
brier.svm.gbm.ACRG10
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm.ACRG = caret::train(gbm.ACRG.train10,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.ACRG.model10 = nnet.gbm.ACRG
predict.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,gbm.ACRG.test10)
table.nnet.gbm.ACRG = table(predict.nnet.gbm.ACRG,y.test)
nnet.gbm.ACRG10 = confusionMatrix(table.nnet.gbm.ACRG)
nnet.gbm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm.ACRG = predict(nnet.gbm.ACRG,newdata = gbm.ACRG.test10, type="prob")
brier.nnet.gbm.ACRG = (brier.nnet.gbm.ACRG)/rowSums(brier.nnet.gbm.ACRG)
brier.nnet.gbm.ACRG10 = multiclass.Brier(brier.nnet.gbm.ACRG,y.test)
brier.nnet.gbm.ACRG10
```

#END OF GBM FEATURES

#START OF SVM FEATURES

#/////CV Fold 1 SVM Features/////

```{r}
trainData_ACRG1 = subtype_ACRG[trainRowNumbers_ACRG$Resample01,]
testData_ACRG1 = subtype_ACRG[-trainRowNumbers_ACRG$Resample01,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG1[, 2:9285])
y= trainData_ACRG1$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG1[, 2:9285])
y.test = testData_ACRG1$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model1 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG1 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG1 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG1
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train1 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test1 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model1 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG1 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG1
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm1 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm1
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model1 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG1 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm1 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm1
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model1 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG1 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm1 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm1
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model1 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG1 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model1,newdata = svm.test1, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm1 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm1
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model1 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG1 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model1,newdata = svm.test1, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm1 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm1
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model1 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG1 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm1 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm1
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model1 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG1 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm1 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm1
```


#/////CV Fold 2 SVM Features/////

```{r}
trainData_ACRG2 = subtype_ACRG[trainRowNumbers_ACRG$Resample02,]
testData_ACRG2 = subtype_ACRG[-trainRowNumbers_ACRG$Resample02,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG2[, 2:9285])
y= trainData_ACRG2$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG2[, 2:9285])
y.test = testData_ACRG2$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model2 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG2 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG2 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG2
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train2 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test2 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model2 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG2 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG2
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm2 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm2
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model2 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG2 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm2 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm2
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model2 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG2 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm2 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm2
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model2 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG2 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model2,newdata = svm.test2, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm2 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm2
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model2 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG2 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model2,newdata = svm.test2, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm2 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm2
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model2 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG2 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm2 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm2
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model2 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG2 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm2 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm2
```


#/////CV Fold 3 SVM Features/////

```{r}
trainData_ACRG3 = subtype_ACRG[trainRowNumbers_ACRG$Resample03,]
testData_ACRG3 = subtype_ACRG[-trainRowNumbers_ACRG$Resample03,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG3[, 2:9285])
y= trainData_ACRG3$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG3[, 2:9285])
y.test = testData_ACRG3$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model3 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG3 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG3 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG3
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train3 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test3 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model3 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG3 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG3
```
```{r}
#Brier Score for svm
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm3 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm3
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model3 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG3 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm3 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm3
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model3 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG3 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm3 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm3
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model3 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG3 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model3,newdata = svm.test3, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm3 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm3
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model3 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG3 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model3,newdata = svm.test3, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm3 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm3
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model3 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG3 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm3 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm3
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model3 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG3 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm3 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm3
```


#/////CV Fold 4 SVM Features/////

```{r}
trainData_ACRG4 = subtype_ACRG[trainRowNumbers_ACRG$Resample04,]
testData_ACRG4 = subtype_ACRG[-trainRowNumbers_ACRG$Resample04,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG4[, 2:9285])
y= trainData_ACRG4$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG4[, 2:9285])
y.test = testData_ACRG4$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model4 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG4 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG4 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG4
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train4 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test4 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model4 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG4 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG4
```
```{r}
#Brier Score for lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm4 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm4
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model4 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG4 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm4 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm4
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model4 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG4 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm4 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm4
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model4 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG4 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model4,newdata = svm.test4, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm4 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm4
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model4 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG4 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model4,newdata = svm.test4, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm4 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm4
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model4 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG4 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm4 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm4
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model4 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG4 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm4 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm4
```


#/////CV Fold 5 SVM Features/////

```{r}
trainData_ACRG5 = subtype_ACRG[trainRowNumbers_ACRG$Resample05,]
testData_ACRG5 = subtype_ACRG[-trainRowNumbers_ACRG$Resample05,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG5[, 2:9285])
y= trainData_ACRG5$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG5[, 2:9285])
y.test = testData_ACRG5$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model5 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG5 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG5 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG5
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train5 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test5 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model5 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG5 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG5
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm5 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm5
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model5 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG5 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm5 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm5
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model5 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG5 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm5 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm5
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model5 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG5 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model5,newdata = svm.test5, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm5 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm5
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model5 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG5 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model5,newdata = svm.test5, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm5 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm5
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model5 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG5 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm5 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm5
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train5,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model5 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test5)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG5 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test5, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm5 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm5
```


#/////CV Fold 6 SVM Features/////

```{r}
trainData_ACRG6 = subtype_ACRG[trainRowNumbers_ACRG$Resample06,]
testData_ACRG6 = subtype_ACRG[-trainRowNumbers_ACRG$Resample06,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG6[, 2:9285])
y= trainData_ACRG6$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG6[, 2:9285])
y.test = testData_ACRG6$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model6 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG6 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG6 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG6
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train6 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test6 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model6 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG6 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG6
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm6 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm6
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model6 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG6 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm6 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm6
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model6 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG6 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm6 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm6
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model6 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG6 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model6,newdata = svm.test6, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm6 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm6
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model6 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG6 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model6,newdata = svm.test6, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm6 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm6
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model6 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG6 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm6 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm6
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model6 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG6 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm6 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm6
```


#/////CV Fold 7 SVM Features/////

```{r}
trainData_ACRG7 = subtype_ACRG[trainRowNumbers_ACRG$Resample07,]
testData_ACRG7 = subtype_ACRG[-trainRowNumbers_ACRG$Resample07,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG7[, 2:9285])
y= trainData_ACRG7$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG7[, 2:9285])
y.test = testData_ACRG7$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model7 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG7 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG7 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG7
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train7 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test7 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model7 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG7 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG7
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm7 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm7
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model7 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG7 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm7 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm7
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model7 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG7 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm7 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm7
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model7 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG7 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model7,newdata = svm.test7, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm7 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm7
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model7 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG7 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model7,newdata = svm.test7, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm7 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm7
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model7 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG7 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm7 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm7
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model7 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG7 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm7 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm7
```


#/////CV Fold 8 SVM Features/////

```{r}
trainData_ACRG8 = subtype_ACRG[trainRowNumbers_ACRG$Resample08,]
testData_ACRG8 = subtype_ACRG[-trainRowNumbers_ACRG$Resample08,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG8[, 2:9285])
y= trainData_ACRG8$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG8[, 2:9285])
y.test = testData_ACRG8$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model8 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG8 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG8 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG8
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train8 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test8 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model8 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG8 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG8
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm8 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm8
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model8 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG8 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm8 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm8
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model8 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG8 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm8 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm8
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model8 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG8 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model8,newdata = svm.test8, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm8 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm8
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model8 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG8 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model8,newdata = svm.test8, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm8 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm8
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model8 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG8 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm8 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm8
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model8 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG8 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm8 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm8
```


#/////CV Fold 9 SVM Features/////

```{r}
trainData_ACRG9 = subtype_ACRG[trainRowNumbers_ACRG$Resample09,]
testData_ACRG9 = subtype_ACRG[-trainRowNumbers_ACRG$Resample09,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG9[, 2:9285])
y= trainData_ACRG9$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG9[, 2:9285])
y.test = testData_ACRG9$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model9 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG9 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG9 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG9
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train9 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test9 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model9 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG9 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG9
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm9 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm9
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model9 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG9 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm9 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm9
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model9 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG9 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm9 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm9
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model9 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG9 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model9,newdata = svm.test9, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm9 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm9
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model9 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG9 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model9,newdata = svm.test9, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm9 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm9
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model9 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG9 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm9 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm9
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model9 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG9 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm9 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm9
```


#/////CV Fold 10 SVM Features/////

```{r}
trainData_ACRG10 = subtype_ACRG[trainRowNumbers_ACRG$Resample10,]
testData_ACRG10 = subtype_ACRG[-trainRowNumbers_ACRG$Resample10,]
```
```{r}
#Make our test and train data
x= data.matrix(trainData_ACRG10[, 2:9285])
y= trainData_ACRG10$Subtype
y = as.factor(y)
x.test= data.matrix(testData_ACRG10[, 2:9285])
y.test = testData_ACRG10$Subtype
y.test = as.factor(y.test)
```
#SVM for feature selections
```{r}
set.seed(99)
svm.ACRG = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.ACRG.model10 = svm.ACRG
predict.svm.ACRG = predict(svm.ACRG,x.test)
table.svm.ACRG = table(predict.svm.ACRG,y.test)
full.svm.ACRG10 = confusionMatrix(table.svm.ACRG)
full.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG = predict(svm.ACRG,newdata = x.test, type = "prob")
brier.svm.ACRG = (brier.svm.ACRG)/rowSums(brier.svm.ACRG)
brier.svm.ACRG10 = multiclass.Brier(brier.svm.ACRG,y.test)
brier.svm.ACRG10
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train10 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.test10 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.ACRG = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.ACRG.model10 = lasso.svm.ACRG
predict.lasso.svm.ACRG = predict(lasso.svm.ACRG,svm.test)
table.lasso.svm.ACRG = table(predict.lasso.svm.ACRG,y.test)
lasso.svm.ACRG10 = confusionMatrix(table.lasso.svm.ACRG, mode = "everything")
lasso.svm.ACRG10
```
```{r}
#Brier Score for Lasso
brier.lasso.ACRG.svm = predict(lasso.svm.ACRG, svm.test, type="prob")
brier.lasso.ACRG.svm = (brier.lasso.ACRG.svm)/rowSums(brier.lasso.ACRG.svm)
brier.lasso.ACRG.svm10 = multiclass.Brier(brier.lasso.ACRG.svm,y.test)
brier.lasso.ACRG.svm10
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.ACRG = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.ACRG.model10 = nb.svm.ACRG
predict.nb.svm.ACRG = predict(nb.svm.ACRG$finalModel,svm.test)
table.nb.svm.ACRG = table(predict.nb.svm.ACRG,y.test)
nb.svm.ACRG10 = confusionMatrix(table.nb.svm.ACRG)
nb.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.ACRG.svm = predict(nb.svm.ACRG,newdata = svm.test, type="prob")
brier.nb.ACRG.svm = (brier.nb.ACRG.svm)/rowSums(brier.nb.ACRG.svm)
brier.nb.ACRG.svm10 = multiclass.Brier(brier.nb.ACRG.svm,y.test)
brier.nb.ACRG.svm10
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.ACRG = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.ACRG.model10 = rf.svm.ACRG
predict.rf.svm.ACRG= predict(rf.svm.ACRG,svm.test)
table.rf.svm.ACRG = table(predict.rf.svm.ACRG,y.test)
rf.svm.ACRG10 = confusionMatrix(table.rf.svm.ACRG)
rf.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.ACRG.svm = predict(rf.svm.ACRG,newdata = svm.test, type="prob")
brier.rf.ACRG.svm = (brier.rf.ACRG.svm)/rowSums(brier.rf.ACRG.svm)
brier.rf.ACRG.svm10 = multiclass.Brier(brier.rf.ACRG.svm,y.test)
brier.rf.ACRG.svm10
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.ACRG.model10 = gbm.svm.ACRG
predict.gbm.svm.ACRG = predict(gbm.svm.ACRG,svm.test)
table.gbm.svm.ACRG = table(predict.gbm.svm.ACRG,y.test)
gbm.svm.ACRG10 = confusionMatrix(table.gbm.svm.ACRG)
gbm.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.ACRG.svm = predict(gbm.svm.ACRG.model10,newdata = svm.test10, type="prob")
brier.gbm.ACRG.svm = (brier.gbm.ACRG.svm)/rowSums(brier.gbm.ACRG.svm)
brier.gbm.ACRG.svm10 = multiclass.Brier(brier.gbm.ACRG.svm,y.test)
brier.gbm.ACRG.svm10
```

#KNN
```{r}
set.seed(99)
knn.svm.ACRG = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.ACRG.model10 = knn.svm.ACRG
predict.knn.svm.ACRG = predict(knn.svm.ACRG,svm.test)
table.knn.svm.ACRG = table(predict.knn.svm.ACRG,y.test)
knn.svm.ACRG10 = confusionMatrix(table.knn.svm.ACRG)
knn.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.ACRG.svm = predict(knn.svm.ACRG.model10,newdata = svm.test10, type="prob")
brier.knn.ACRG.svm = (brier.knn.ACRG.svm)/rowSums(brier.knn.ACRG.svm)
brier.knn.ACRG.svm10 = multiclass.Brier(brier.knn.ACRG.svm,y.test)
brier.knn.ACRG.svm10
```

#SVM
```{r}
set.seed(99)
svm.svm.ACRG = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.ACRG.model10 = svm.svm.ACRG
predict.svm.svm.ACRG = predict(svm.svm.ACRG,svm.test)
table.svm.svm.ACRG = table(predict.svm.svm.ACRG,y.test)
svm.svm.ACRG10 = confusionMatrix(table.svm.svm.ACRG)
svm.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.ACRG.svm = predict(svm.svm.ACRG,newdata = svm.test, type = "prob")
brier.svm.ACRG.svm = (brier.svm.ACRG.svm)/rowSums(brier.svm.ACRG.svm)
brier.svm.ACRG.svm10 = multiclass.Brier(brier.svm.ACRG.svm,y.test)
brier.svm.ACRG.svm10
```

#Neural Net
```{r}
set.seed(99)
nnet.svm.ACRG = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.ACRG.model10 = nnet.svm.ACRG
predict.nnet.svm.ACRG = predict(nnet.svm.ACRG,svm.test)
table.nnet.svm.ACRG = table(predict.nnet.svm.ACRG,y.test)
nnet.svm.ACRG10 = confusionMatrix(table.nnet.svm.ACRG)
nnet.svm.ACRG10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.ACRG.svm = predict(nnet.svm.ACRG,newdata = svm.test, type="prob")
brier.nnet.ACRG.svm = (brier.nnet.ACRG.svm)/rowSums(brier.nnet.ACRG.svm)
brier.nnet.ACRG.svm10 = multiclass.Brier(brier.nnet.ACRG.svm,y.test)
brier.nnet.ACRG.svm10
```



#/////END SVM////

#FINAL MODEL
```{r}
#Make our test and train data
x= data.matrix(subtype_ACRG[, 2:9285])
y= subtype_ACRG$Subtype
y = as.factor(y)
```

```{r}
set.seed(99)
svm.ACRG.final = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.ACRG.final)
svm.features = svm.features$importance
MSS_TP53neg.svm = dplyr::select(svm.features, "MSS_TP53neg")
MSS_TP53neg.svm = MSS_TP53neg.svm %>% filter(rank(desc(MSS_TP53neg.svm))<=15)
MSS_TP53pos.svm = dplyr::select(svm.features, "MSS_TP53pos")
MSS_TP53pos.svm = MSS_TP53pos.svm %>% filter(rank(desc(MSS_TP53pos.svm))<=15)
MSI.svm = dplyr::select(svm.features, "MSI")
MSI.svm = MSI.svm %>% filter(rank(desc(MSI.svm))<=15)
EMT.svm = dplyr::select(svm.features, "EMT")
EMT.svm = EMT %>% filter(rank(desc(EMT))<=15)
```
```{r}
MSS_TP53neg.svm = row.names(MSS_TP53neg.svm)
MSS_TP53pos.svm = row.names(MSS_TP53pos.svm)
MSI.svm = row.names(MSI.svm)
EMT.svm = row.names(EMT.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(MSS_TP53neg.svm,MSS_TP53pos.svm)
svm.topfeatures = append(svm.topfeatures,MSI.svm)
svm.topfeatures = append(svm.topfeatures,EMT.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.final.features = as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.ACRG_final = caret::train(svm.final.features,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))

acrgfinalgenes = colnames(svm.final.features)
```
```{r}
write.csv(acrgfinalgenes, 'acrgfinalgenes.csv')
```

#Final calibration model - L2 regularized binomial logistic regression optimizing logloss. 
```{r}
final_probs = predict(gbm.svm.ACRG_final,newdata = svm.final.features, type="prob")
final_probs[final_probs == 0] <- 2.225074e-308

set.seed(99)
acrg.final.calibration = caret::train(final_probs,y,'multinom',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs=TRUE), tuneGrid = expand.grid(decay = c(0,1e-8,1e-6,1e-4,1e-2,1e-1,1,10,15,20)))
acrg.final.calibration

set.seed(99)
acrg.final.calibration = caret::train(final_probs,y,'multinom',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs=TRUE, summaryFunction=mnLogLoss), metric = "logLoss", tuneGrid = expand.grid(decay = c(0,1e-8,1e-6,1e-4,1e-2,1e-1,1,10,15,20)))
acrg.final.calibration
```

#Compile Model Metrics
#Lasso compile
```{r}
#Full lasso
total_list <- lapply(mget(ls(pattern = 'full.ACRG.lasso\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models1 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models1) <- c("Accuracy", "Kappa")
acrg_models1$Brier_score = mget(ls(pattern = 'brier.lasso.ACRGfull\\d+'))
acrg_models1$Model <- 'Full Elastic Net'
acrg_models1$FS <- 'Full'
remove(total_list)


#Lasso lasso
total_list <- lapply(mget(ls(pattern = 'lasso.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models2 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models2) <- c("Accuracy", "Kappa")
acrg_models2$Brier_score = mget(ls(pattern = 'brier.lasso.ACRG.lasso\\d+'))
acrg_models2$Model <- 'Elastic Net Elastic Net'
acrg_models2$FS <- 'Elastic Net'
remove(total_list)

#NB lasso
total_list <- lapply(mget(ls(pattern = 'nb.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models3 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models3) <- c("Accuracy", "Kappa")
acrg_models3$Brier_score = mget(ls(pattern = 'brier.nb.ACRG.lasso\\d+'))
acrg_models3$Model <- 'NB Elastic Net'
acrg_models3$FS <- 'Elastic Net'
remove(total_list)

#RF lasso
total_list <- lapply(mget(ls(pattern = 'rf.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models4 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models4) <- c("Accuracy", "Kappa")
acrg_models4$Brier_score = mget(ls(pattern = 'brier.rf.ACRG.lasso\\d+'))
acrg_models4$Model <- 'RF Elastic Net'
acrg_models4$FS <- 'Elastic Net'
remove(total_list)


#GBM lasso
total_list <- lapply(mget(ls(pattern = 'gbm.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models5 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models5) <- c("Accuracy", "Kappa")
acrg_models5$Brier_score = mget(ls(pattern = 'brier.gbm.ACRG.lasso\\d+'))
acrg_models5$Model <- 'GBM Elastic Net'
acrg_models5$FS <- 'Elastic Net'
remove(total_list)

#KNN lasso
total_list <- lapply(mget(ls(pattern = 'knn.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models6 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models6) <- c("Accuracy", "Kappa")
acrg_models6$Brier_score = mget(ls(pattern = 'brier.knn.ACRG.lasso\\d+'))
acrg_models6$Model <- 'KNN Elastic Net'
acrg_models6$FS <- 'Elastic Net'
remove(total_list)

#SVM lasso
total_list <- lapply(mget(ls(pattern = 'svm.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models7 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models7) <- c("Accuracy", "Kappa")
acrg_models7$Brier_score = mget(ls(pattern = 'brier.svm.ACRG.lasso\\d+'))
acrg_models7$Model <- 'SVM Elastic Net'
acrg_models7$FS <- 'Elastic Net'
remove(total_list)

#NNET lasso
total_list <- lapply(mget(ls(pattern = 'nnet.lasso.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models8 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models8) <- c("Accuracy", "Kappa")
acrg_models8$Brier_score = mget(ls(pattern = 'brier.nnet.ACRG.lasso\\d+'))
acrg_models8$Model <- 'NNET Elastic Net'
acrg_models8$FS <- 'Elastic Net'
remove(total_list)
```
#GBM compile
```{r}
#GBM feature selection
total_list <- lapply(mget(ls(pattern = 'full.gbm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models9 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models9) <- c("Accuracy", "Kappa")
acrg_models9$Brier_score = mget(ls(pattern = 'brier.gbm.ACRG\\d+'))
acrg_models9$Model <- 'Full GBM'
acrg_models9$FS <- 'Full'
remove(total_list)

#Lasso GBM selection
total_list <- mget(ls(pattern = 'lasso.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models10 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models10) <- c("Accuracy", "Kappa")
acrg_models10$Brier_score = mget(ls(pattern = 'brier.lasso.gbm.ACRG\\d+'))
acrg_models10$Model <- 'Elastic Net GBM'
acrg_models10$FS <- 'GBM'
acrg_models10 = dplyr::select(acrg_models10, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NB GBM
total_list <- mget(ls(pattern = 'nb.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models11 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models11) <- c("Accuracy", "Kappa")
acrg_models11$Brier_score = mget(ls(pattern = 'brier.nb.gbm.ACRG\\d+'))
acrg_models11$Model <- 'NB GBM'
acrg_models11$FS <- 'GBM'
acrg_models11 = dplyr::select(acrg_models11, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#RF GBM
total_list <- mget(ls(pattern = 'rf.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models12 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models12) <- c("Accuracy", "Kappa")
acrg_models12$Brier_score = mget(ls(pattern = 'brier.rf.gbm.ACRG\\d+'))
acrg_models12$Model <- 'RF GBM'
acrg_models12$FS <- 'GBM'
acrg_models12 = dplyr::select(acrg_models12, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#GBM GBM
total_list <- mget(ls(pattern = 'gbm.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models13 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models13) <- c("Accuracy", "Kappa")
acrg_models13$Brier_score = mget(ls(pattern = 'brier.gbm.gbm.ACRG\\d+'))
acrg_models13$Model <- 'GBM GBM'
acrg_models13$FS <- 'GBM'
acrg_models13 = dplyr::select(acrg_models13, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#KNN GBM
total_list <- mget(ls(pattern = 'knn.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models14 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models14) <- c("Accuracy", "Kappa")
acrg_models14$Brier_score = mget(ls(pattern = 'brier.knn.gbm.ACRG\\d+'))
acrg_models14$Model <- 'KNN GBM'
acrg_models14$FS <- 'GBM'
acrg_models14 = dplyr::select(acrg_models14, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#SVM GBM
total_list <- mget(ls(pattern = 'svm.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models15 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models15) <- c("Accuracy", "Kappa")
acrg_models15$Brier_score = mget(ls(pattern = 'brier.svm.gbm.ACRG\\d+'))
acrg_models15$Model <- 'SVM GBM'
acrg_models15$FS <- 'GBM'
acrg_models15 = dplyr::select(acrg_models15, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NNET GBM
total_list <- mget(ls(pattern = 'nnet.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
acrg_models16 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models16) <- c("Accuracy", "Kappa")
acrg_models16$Brier_score = mget(ls(pattern = 'brier.nnet.gbm.ACRG\\d+'))
acrg_models16$Model <- 'NNET GBM'
acrg_models16$FS <- 'GBM'
acrg_models16 = dplyr::select(acrg_models16, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)
```
#SVM compile
```{r}
#SVM feature selection
total_list <- lapply(mget(ls(pattern = 'full.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models17 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models17) <- c("Accuracy", "Kappa")
acrg_models17$Brier_score = mget(ls(pattern = 'brier.svm.ACRG\\d+'))
acrg_models17$Model <- 'Full SVM'
acrg_models17$FS <- 'Full'
remove(total_list)


#Lasso SVM selection
total_list <- lapply(mget(ls(pattern = 'lasso.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models18 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models18) <- c("Accuracy", "Kappa")
acrg_models18$Brier_score = mget(ls(pattern = 'brier.lasso.ACRG.svm\\d+'))
acrg_models18$Model <- 'Elastic Net SVM'
acrg_models18$FS <- 'SVM'
remove(total_list)

#NB SVM
total_list <- lapply(mget(ls(pattern = 'nb.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models19 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models19) <- c("Accuracy", "Kappa")
acrg_models19$Brier_score = mget(ls(pattern = 'brier.nb.ACRG.svm\\d+'))
acrg_models19$Model <- 'NB SVM'
acrg_models19$FS <- 'SVM'
remove(total_list)

#RF SVM
total_list <- lapply(mget(ls(pattern = 'rf.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models20 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models20) <- c("Accuracy", "Kappa")
acrg_models20$Brier_score = mget(ls(pattern = 'brier.rf.ACRG.svm\\d+'))
acrg_models20$Model <- 'RF SVM'
acrg_models20$FS <- 'SVM'
remove(total_list)


#GBM SVM
total_list <- lapply(mget(ls(pattern = 'gbm.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models21 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models21) <- c("Accuracy", "Kappa")
acrg_models21$Brier_score = mget(ls(pattern = 'brier.gbm.ACRG.svm\\d+'))
acrg_models21$Model <- 'GBM SVM'
acrg_models21$FS <- 'SVM'
remove(total_list)

#KNN SVM
total_list <- lapply(mget(ls(pattern = 'knn.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models22 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models22) <- c("Accuracy", "Kappa")
acrg_models22$Brier_score = mget(ls(pattern = 'brier.knn.ACRG.svm\\d+'))
acrg_models22$Model <- 'KNN SVM'
acrg_models22$FS <- 'SVM'
remove(total_list)

#SVM SVM
total_list <- lapply(mget(ls(pattern = 'svm.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models23 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models23) <- c("Accuracy", "Kappa")
acrg_models23$Brier_score = mget(ls(pattern = 'brier.svm.ACRG.svm\\d+'))
acrg_models23$Model <- 'SVM SVM'
acrg_models23$FS <- 'SVM'
remove(total_list)

#NNET GBM
total_list <- lapply(mget(ls(pattern = 'nnet.svm.ACRG\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
acrg_models24 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(acrg_models24) <- c("Accuracy", "Kappa")
acrg_models24$Brier_score = mget(ls(pattern = 'brier.nnet.ACRG.svm\\d+'))
acrg_models24$Model <- 'NNET SVM'
acrg_models24$FS <- 'SVM'
remove(total_list)


```
#Complile ACRG data

#Plots

```{r}
#compile tcga models
total_list <- mget(ls(pattern = 'acrg_models\\d+'))
compile_acrg_model = do.call(rbind, total_list)
compile_acrg_model$Brier_score = unlist(compile_acrg_model$Brier_score)

compile_acrg_model_long = melt(compile_acrg_model, id.vars=c("Model", "FS"))



ggplot(compile_acrg_model_long, aes(x=Model, y=value, fill=variable)) + 
    geom_boxplot() +
  geom_jitter( size=2, alpha=0.1) +
  ylim(c(0,1)) + 
  facet_wrap(~variable)

ggplot(compile_acrg_model, aes(x=reorder(Model, -Accuracy), y=Accuracy, fill=FS)) + 
    geom_boxplot() +
  geom_jitter( size=2, alpha=0.1) +
  ylim(c(0,1)) 


library(Rmisc)

patient_model_data_accuracy <- summarySE(compile_acrg_model, measurevar="Accuracy", groupvars="Model")
patient_model_data_kappa <- summarySE(compile_acrg_model, measurevar="Kappa", groupvars="Model")
patient_model_data_brier <- summarySE(compile_acrg_model, measurevar="Brier_score", groupvars="Model")

colnames(patient_model_data_accuracy)[which(names(patient_model_data_accuracy) == "Accuracy")] <- "Value"
colnames(patient_model_data_kappa)[which(names(patient_model_data_kappa) == "Kappa")] <- "Value"
colnames(patient_model_data_brier)[which(names(patient_model_data_brier) == "Brier_score")] <- "Value"

patient_model_data_accuracy$Metric = 'Accuracy' 
patient_model_data_kappa$Metric = 'Kappa' 
patient_model_data_brier$Metric = 'Brier Score'

patient_model_data<-grep("patient_model_data",names(.GlobalEnv),value=TRUE)
patient_model_data<-do.call("list",mget(patient_model_data))
tcga_model_metrics = do.call(rbind, patient_model_data)

ggplot(tcga_model_metrics, aes(x=reorder(Model,-Value), y=Value, fill=Metric)) + 
    geom_bar(position=position_dodge(), stat="identity", colour= "black") +
    geom_errorbar(aes(ymin=Value-sd, ymax=Value+sd),
                  width=.2,                  
                  position=position_dodge(.9)) + 
  scale_fill_manual("Metric", values = c("Accuracy" = "skyblue3", "Kappa" = "seagreen3", "Brier Score" = "purple")) + 
  scale_y_continuous(limit = c(0, 1)) +
  ggtitle("Tumour Characteristics") + 
  ylab("Value") +
  theme_classic()  + 
  theme(axis.text.x = element_text(colour="black", size = 12,angle = 45, hjust=1)) +
  theme(axis.text.y = element_text(colour="black",size = 12)) + 
  theme(plot.title = element_text(colour="black", size=12,hjust = 0)) +
  theme(axis.title.x = element_blank()) +
  theme(axis.title.y = element_text(colour="black", size=12)) +
  theme(legend.position = "none" ) +
  facet_wrap(~Metric)

  geom_bar(aes(y = median), stat = "unique", width= 0.3) +


fun.args = list(mult = 1)

ggplot(compile_tcga_model_long, aes(x=Model, y=value)) +
  facet_grid(.~variable) +
  stat_summary(mapping=aes(fill=variable), fun=mean, geom='bar', alpha=0.5, color='black') +
  stat_summary(fun.data = mean_sdl,fun.args = list(mult = 1), geom='errorbar', color='black') +
  geom_jitter(aes(color=variable), 
              position=position_jitter(width=0.2), alpha=0.8) +
  theme(axis.text.x = element_text(angle=45))


ggplot(compile_acrg_model, aes(x=Model, y=Accuracy)) +
  stat_summary(mapping=aes(fill=Model), fun=mean, geom='bar', alpha=0.5, color='black') +
  stat_summary(fun.data = mean_sdl,fun.args = list(mult = 1), geom='errorbar', color='black') +
  geom_jitter(aes(color=Model), 
              position=position_jitter(width=0.2), alpha=0.8) +
  theme(axis.text.x = element_text(angle=45))



ggplot(compile_acrg_model, aes(x=reorder(Model, -Accuracy), y=Accuracy)) +
        stat_summary(mapping=aes(fill=FS), fun=mean, geom='bar', alpha=0.5, color='black') +
        stat_summary(fun.data = mean_sdl,fun.args = list(mult = 1), geom='errorbar', color='black') +
        geom_jitter(aes(color=FS), position=position_jitter(width=0.2), alpha=0.8) +
      scale_fill_manual("FS", values = c("Elastic Net" = "#4DBBD5FF", "Full" = "#00A087FF", "GBM" = "#3C5488FF", "SVM" = "#F39B7FFF" )) + 
  scale_colour_manual("FS", values = c("Elastic Net" = "#4DBBD5FF", "Full" = "#00A087FF", "GBM" = "#3C5488FF", "SVM" = "#F39B7FFF" )) +
        theme(axis.text.x = element_text(angle=45)) +
  theme_classic() + geom_hline(yintercept = 0.8878378, linetype = 2, colour = "red")


```
#Export data dataframe
```{r}
write.csv(compile_acrg_model,file = "compile_acrg_model.csv")
write.csv(compile_acrg_model_long,file = "compile_acrg_model_long.csv")
```




#Compile per type Model Metrics
#Lasso compile
```{r}
#Full lasso
total_list <- lapply(mget(ls(pattern = 'full.ACRG.lasso\\d+')), function(x) {
         data <- x$byClass})
acrg_class1 = melt(total_list)
acrg_class1 = summarySE(acrg_class1, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class1 = dplyr::select(acrg_class1, -c("N","se", "ci"))
acrg_class1 = reshape(acrg_class1,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class1$Model = "Full Elastic Net"
remove(total_list)

#Lasso lasso
total_list <- lapply(mget(ls(pattern = 'lasso.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class2 = melt(total_list)
acrg_class2 = summarySE(acrg_class2, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class2 = dplyr::select(acrg_class2, -c("N","se", "ci"))
acrg_class2 = reshape(acrg_class2,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class2$Model = "Elastic Net Elastic Net"
remove(total_list)

#NB lasso
total_list <- lapply(mget(ls(pattern = 'nb.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class3 = melt(total_list)
acrg_class3 = summarySE(acrg_class3, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class3 = dplyr::select(acrg_class3, -c("N","se", "ci"))
acrg_class3 = reshape(acrg_class3,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class3$Model = "NB Elastic Net"
remove(total_list)


#RF lasso
total_list <- lapply(mget(ls(pattern = 'rf.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class4 = melt(total_list)
acrg_class4 = summarySE(acrg_class4, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class4 = dplyr::select(acrg_class4, -c("N","se", "ci"))
acrg_class4 = reshape(acrg_class4,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class4$Model = "RF Elastic Net"
remove(total_list)

#GBM lasso
total_list <- lapply(mget(ls(pattern = 'gbm.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class5 = melt(total_list)
acrg_class5 = summarySE(acrg_class5, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class5 = dplyr::select(acrg_class5, -c("N","se", "ci"))
acrg_class5 = reshape(acrg_class5,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class5$Model = "GBM Elastic Net"
remove(total_list)

#KNN lasso
total_list <- lapply(mget(ls(pattern = 'knn.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class6 = melt(total_list)
acrg_class6 = summarySE(acrg_class6, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class6 = dplyr::select(acrg_class6, -c("N","se", "ci"))
acrg_class6 = reshape(acrg_class6,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class6$Model = "KNN Elastic Net"
remove(total_list)

#SVM lasso
total_list <- lapply(mget(ls(pattern = 'svm.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class7 = melt(total_list)
acrg_class7 = summarySE(acrg_class7, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class7 = dplyr::select(acrg_class7, -c("N","se", "ci"))
acrg_class7 = reshape(acrg_class7,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class7$Model = "KNN Elastic Net"
remove(total_list)

#NNET lasso
total_list <- lapply(mget(ls(pattern = 'nnet.lasso.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class8 = melt(total_list)
acrg_class8 = summarySE(acrg_class8, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class8 = dplyr::select(acrg_class8, -c("N","se", "ci"))
acrg_class8 = reshape(acrg_class8,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class8$Model = "NNET Elastic Net"
remove(total_list)
```

#GBM compile
```{r}
#GBM feature selection
total_list <- lapply(mget(ls(pattern = 'full.gbm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class9 = melt(total_list)
acrg_class9 = summarySE(acrg_class9, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class9 = dplyr::select(acrg_class9, -c("N","se", "ci"))
acrg_class9 = reshape(acrg_class9,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class9$Model = "Full GBM"
remove(total_list)

#Lasso GBM selection
total_list <- mget(ls(pattern = 'lasso.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class10 = melt(total_list)
acrg_class10 = summarySE(acrg_class10, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class10 = dplyr::select(acrg_class10, -c("N","se", "ci"))
acrg_class10 = reshape(acrg_class10,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class10$Model = "Elastic Net GBM"
remove(total_list)

#NB GBM
total_list <- mget(ls(pattern = 'nb.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class11 = melt(total_list)
acrg_class11 = summarySE(acrg_class11, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class11 = dplyr::select(acrg_class11, -c("N","se", "ci"))
acrg_class11 = reshape(acrg_class11,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class11$Model = "NB GBM"
remove(total_list)

#RF GBM
total_list <- mget(ls(pattern = 'rf.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class12 = melt(total_list)
acrg_class12 = summarySE(acrg_class12, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class12 = dplyr::select(acrg_class12, -c("N","se", "ci"))
acrg_class12 = reshape(acrg_class12,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class12$Model = "RF GBM"
remove(total_list)

#GBM GBM
total_list <- mget(ls(pattern = 'gbm.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class13 = melt(total_list)
acrg_class13 = summarySE(acrg_class13, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class13 = dplyr::select(acrg_class13, -c("N","se", "ci"))
acrg_class13 = reshape(acrg_class13,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class13$Model = "GBM GBM"
remove(total_list)

#KNN GBM
total_list <- mget(ls(pattern = 'knn.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class14 = melt(total_list)
acrg_class14 = summarySE(acrg_class14, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class14 = dplyr::select(acrg_class14, -c("N","se", "ci"))
acrg_class14 = reshape(acrg_class14,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class14$Model = "KNN GBM"
remove(total_list)

#SVM GBM
total_list <- mget(ls(pattern = 'svm.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class15 = melt(total_list)
acrg_class15 = summarySE(acrg_class15, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class15 = dplyr::select(acrg_class15, -c("N","se", "ci"))
acrg_class15 = reshape(acrg_class15,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class15$Model = "SVM GBM"
remove(total_list)

#NNET GBM
total_list <- mget(ls(pattern = 'nnet.gbm.ACRG\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
acrg_class16 = melt(total_list)
acrg_class16 = summarySE(acrg_class16, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class16 = dplyr::select(acrg_class16, -c("N","se", "ci"))
acrg_class16 = reshape(acrg_class16,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class16$Model = "NNET GBM"
remove(total_list)

```
#SVM compile
```{r}
#SVM feature selection
total_list <- lapply(mget(ls(pattern = 'full.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class17 = melt(total_list)
acrg_class17 = summarySE(acrg_class17, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class17 = dplyr::select(acrg_class17, -c("N","se", "ci"))
acrg_class17 = reshape(acrg_class17,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class17$Model = "Full SVM"
remove(total_list)

#Lasso SVM selection
total_list <- lapply(mget(ls(pattern = 'lasso.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class18 = melt(total_list)
acrg_class18 = summarySE(acrg_class18, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class18 = dplyr::select(acrg_class18, -c("N","se", "ci"))
acrg_class18 = reshape(acrg_class18,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class18$Model = "Elastic Net SVM"
remove(total_list)

#NB SVM
total_list <- lapply(mget(ls(pattern = 'nb.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class19 = melt(total_list)
acrg_class19 = summarySE(acrg_class19, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class19 = dplyr::select(acrg_class19, -c("N","se", "ci"))
acrg_class19 = reshape(acrg_class19,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class19$Model = "NB SVM"
remove(total_list)

#RF SVM
total_list <- lapply(mget(ls(pattern = 'rf.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class20 = melt(total_list)
acrg_class20 = summarySE(acrg_class20, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class20 = dplyr::select(acrg_class20, -c("N","se", "ci"))
acrg_class20 = reshape(acrg_class20,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class20$Model = "RF SVM"
remove(total_list)


#GBM SVM
total_list <- lapply(mget(ls(pattern = 'gbm.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class21 = melt(total_list)
acrg_class21 = summarySE(acrg_class21, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class21 = dplyr::select(acrg_class21, -c("N","se", "ci"))
acrg_class21 = reshape(acrg_class21,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class21$Model = "GBM SVM"
remove(total_list)

#KNN SVM
total_list <- lapply(mget(ls(pattern = 'knn.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class22 = melt(total_list)
acrg_class22 = summarySE(acrg_class22, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class22 = dplyr::select(acrg_class22, -c("N","se", "ci"))
acrg_class22 = reshape(acrg_class22,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class22$Model = "KNN SVM"
remove(total_list)

#SVM SVM
total_list <- lapply(mget(ls(pattern = 'svm.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class23 = melt(total_list)
acrg_class23 = summarySE(acrg_class23, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class23 = dplyr::select(acrg_class23, -c("N","se", "ci"))
acrg_class23 = reshape(acrg_class23,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class23$Model = "SVM SVM"
remove(total_list)

#NNET GBM
total_list <- lapply(mget(ls(pattern = 'nnet.svm.ACRG\\d+')), function(x) {
         data <- x$byClass})
acrg_class24 = melt(total_list)
acrg_class24 = summarySE(acrg_class24, measurevar=c("value") , groupvars=c("Var1", "Var2"))
acrg_class24 = dplyr::select(acrg_class24, -c("N","se", "ci"))
acrg_class24 = reshape(acrg_class24,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
acrg_class24$Model = "NNET SVM"
remove(total_list)
```

```{r}
total_list <- mget(ls(pattern = 'acrg_class\\d+'))
compile_acrg_class = do.call(rbind, total_list)
```

#Export data dataframe
```{r}
write.csv(compile_acrg_class,file = "compile_acrg_class.csv")
```








