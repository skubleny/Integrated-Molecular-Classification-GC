---
title: "TCGA Classifier"
author: "Daniel Skubleny"
date: "03/02/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Require loaded data and libraries from Exploratory Data Analysis

The purpose of this document is to create classifiers for TCGA subtypes which we can later train additional samples on. We will perform feature selection of our preprocessed dataset to create an efficient model with fewer genes. 

We will use multinomial logistic regression with LASSO, Random Forest and SVM for feature selection.

We will train models using Naive Bayes, Random Forest, Gradient Boost, XG Boost and KNN. 

#Set our data up

Need to reduce dataset to common genes
```{r}
log_TCGA = log_edata
dim(log_TCGA)
```
```{r}
edata_TCGA <- subset(log_TCGA, rownames(log_TCGA) %in% as.matrix(commongenes))
```

Need to set up transpose edata_TCGA and make subtype a column. 

```{r}
#Transpose data and make Sample Id a column to merge with subtype
tedata_TCGA = as.data.frame(t(edata_TCGA))
subtype_edata = tedata_TCGA 
subtype_edata = tibble::rownames_to_column(subtype_edata, "SAMPLE_ID")
```
```{r}
#Make reference subtype dataframe
subtype_df = dplyr::select(pdata, c("SAMPLE_ID", "SUBTYPE"))
subtype_df$SAMPLE_ID = str_replace_all(subtype_df$SAMPLE_ID, c("-" = "."))
```
```{r}
#Merge expression data and subtype allocation
subtype_edata = merge(subtype_df, subtype_edata, by.x="SAMPLE_ID")
subtype_edata = as.data.frame(subtype_edata)
subtype_edata = subtype_edata %>% tibble::column_to_rownames("SAMPLE_ID") # Make the first column the row name
```

### THIS IS WHERE I NEED TO ESTABLISH MY NESTED CV. 

```{r}
subtype_edata = as.data.frame(subtype_edata)
#Create 80/20% data split at random

#Convert numeric columns to numeric
subtype_edata[,2:ncol(subtype_edata)] = lapply(2:ncol(subtype_edata),function(x) as.numeric(subtype_edata[[x]]))
```
```{r}
set.seed(99)
trainRowNumbers = createDataPartition(subtype_edata$SUBTYPE, p=0.8,list=FALSE,times = 10)
trainRowNumbers = as.data.frame(trainRowNumbers)
```

#/////CV fold 1 for lasso features/////

```{r}
trainData1 = subtype_edata[trainRowNumbers$Resample01,]
testData1 = subtype_edata[-trainRowNumbers$Resample01,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData1[, 2:9285])
y= trainData1$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData1[, 2:9285])
y.test = testData1$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

#########################################################################################################
#########################################################################################################
NOTE - the final lasso and elastic net models used the 1se cut-off for feature selection. This is in the
1se TCGA file.
#########################################################################################################
#########################################################################################################

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model1 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso1 = confusionMatrix(table.lasso.10fold, mode = "everything")
full.lasso1
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full1 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full1
```


#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA1 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA1 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model1 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso1 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso1
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso1 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso1
```

#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model1 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso1 = confusionMatrix(table.nb.lasso)
nb.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso1 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso1
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model1 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso1 = confusionMatrix(table.rf.lasso)
rf.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso1 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso1
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model1 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso1 = confusionMatrix(table.gbm.lasso, mode = "everything")
gbm.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso1 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso1
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model1 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso1 = confusionMatrix(table.knn.lasso)
knn.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso1 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso1
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model1 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso1 = confusionMatrix(table.svm.lasso)
svm.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type = "prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso1 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso1
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model1 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso1 = confusionMatrix(table.nnet.lasso)
nnet.lasso1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso1 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso1
```

#/////CV fold 2 for Lasso features/////

```{r}
trainData2 = subtype_edata[trainRowNumbers$Resample02,]
testData2 = subtype_edata[-trainRowNumbers$Resample02,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData2[, 2:9285])
y= trainData2$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData2[, 2:9285])
y.test = testData2$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model2 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso2 = confusionMatrix(table.lasso.10fold)
full.lasso2
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full2 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full2
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA2 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA2 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model2 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso2 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso2
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso2 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso2
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model2=nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso2 = confusionMatrix(table.nb.lasso)
nb.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso2 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso2
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model2 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso2 = confusionMatrix(table.rf.lasso)
rf.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso2 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso2
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model2 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso2 = confusionMatrix(table.gbm.lasso)
gbm.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso2 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso2
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model2 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso2 = confusionMatrix(table.knn.lasso)
knn.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso2 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso2
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model2 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso2 = confusionMatrix(table.svm.lasso)
svm.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso2 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso2
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model2 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso2 = confusionMatrix(table.nnet.lasso)
nnet.lasso2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso2 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso2
```

#/////CV fold 3 for Lasso features/////

```{r}
trainData3 = subtype_edata[trainRowNumbers$Resample03,]
testData3 = subtype_edata[-trainRowNumbers$Resample03,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData3[, 2:9285])
y= trainData3$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData3[, 2:9285])
y.test = testData3$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model3 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso3 = confusionMatrix(table.lasso.10fold)
full.lasso3
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full3 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full3
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA3 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA3 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model3 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso3 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso3
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso3 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso3
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model3 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso3 = confusionMatrix(table.nb.lasso)
nb.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso3 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso3
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model3 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso3 = confusionMatrix(table.rf.lasso)
rf.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso3 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso3
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model3 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso3 = confusionMatrix(table.gbm.lasso)
gbm.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso3 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso3
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model3 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso3 = confusionMatrix(table.knn.lasso)
knn.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso3 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso3
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model3 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso3 = confusionMatrix(table.svm.lasso)
svm.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso3 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso3
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model3 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso3 = confusionMatrix(table.nnet.lasso)
nnet.lasso3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso3 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso3
```




#/////CV fold 4 for Lasso features/////

```{r}
trainData4 = subtype_edata[trainRowNumbers$Resample04,]
testData4 = subtype_edata[-trainRowNumbers$Resample04,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData4[, 2:9285])
y= trainData4$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData4[, 2:9285])
y.test = testData4$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model4 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso4 = confusionMatrix(table.lasso.10fold)
full.lasso4
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full4 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full4
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA4 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA4 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model4 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso4 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso4
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso4 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso4
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model4 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso4 = confusionMatrix(table.nb.lasso)
nb.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso4 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso4
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model4 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso4 = confusionMatrix(table.rf.lasso)
rf.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso4 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso4
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model4 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso4 = confusionMatrix(table.gbm.lasso)
gbm.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso4 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso4
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso4 = confusionMatrix(table.knn.lasso)
knn.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso4 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso4
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model4 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso4 = confusionMatrix(table.svm.lasso)
svm.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso4 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso4
```

#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model4 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso4 = confusionMatrix(table.nnet.lasso)
nnet.lasso4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso4 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso4
```




#/////CV fold 5 for Lasso features/////

```{r}
trainData5 = subtype_edata[trainRowNumbers$Resample05,]
testData5 = subtype_edata[-trainRowNumbers$Resample05,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData5[, 2:9285])
y= trainData5$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData5[, 2:9285])
y.test = testData5$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model5 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso5 = confusionMatrix(table.lasso.10fold)
full.lasso5
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full5 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full5
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA5 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA5 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model5 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso5 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso5
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso5 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso5
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model5 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso5 = confusionMatrix(table.nb.lasso)
nb.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso5 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso5
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model5 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso5 = confusionMatrix(table.rf.lasso)
rf.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso5 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso5
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model5 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso5 = confusionMatrix(table.gbm.lasso)
gbm.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso5 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso5
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model5 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso5 = confusionMatrix(table.knn.lasso)
knn.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso5 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso5
```
#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model5 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso5 = confusionMatrix(table.svm.lasso)
svm.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso5 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso5
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model5 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso5 = confusionMatrix(table.nnet.lasso)
nnet.lasso5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso5 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso5
```

#/////CV fold 6 for Lasso features/////

```{r}
trainData6 = subtype_edata[trainRowNumbers$Resample06,]
testData6 = subtype_edata[-trainRowNumbers$Resample06,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData6[, 2:9285])
y= trainData6$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData6[, 2:9285])
y.test = testData6$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model6 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso6 = confusionMatrix(table.lasso.10fold)
full.lasso6
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full6 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full6
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA6 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA6 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model6 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso6 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso6
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso6 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso6
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model6 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso6 = confusionMatrix(table.nb.lasso)
nb.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso6 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso6
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model6 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso6 = confusionMatrix(table.rf.lasso)
rf.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso6 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso6
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model6 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso6 = confusionMatrix(table.gbm.lasso)
gbm.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso6 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso6
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model6 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso6 = confusionMatrix(table.knn.lasso)
knn.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso6 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso6
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model6 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso6 = confusionMatrix(table.svm.lasso)
svm.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso6 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso6
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model6 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso6 = confusionMatrix(table.nnet.lasso)
nnet.lasso6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso6 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso6
```

#/////CV fold 7 for Lasso features/////

```{r}
trainData7 = subtype_edata[trainRowNumbers$Resample07,]
testData7 = subtype_edata[-trainRowNumbers$Resample07,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData7[, 2:9285])
y= trainData7$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData7[, 2:9285])
y.test = testData7$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model7 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso7 = confusionMatrix(table.lasso.10fold)
full.lasso7
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full7 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full7
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA7 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA7 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model7 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso7 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso7
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso7 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso7
```
#Naive Bayes with lasso features
```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model7 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso7 = confusionMatrix(table.nb.lasso)
nb.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso7 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso7
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model7 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso7 = confusionMatrix(table.rf.lasso)
rf.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso7 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso7
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model7 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso7 = confusionMatrix(table.gbm.lasso)
gbm.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso7 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso7
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model7 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso7 = confusionMatrix(table.knn.lasso)
knn.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso7 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso7
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model7 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso7 = confusionMatrix(table.svm.lasso)
svm.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso7 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso7
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model7 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso7 = confusionMatrix(table.nnet.lasso)
nnet.lasso7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso7 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso7
```

#/////CV fold 8 for Lasso features/////

```{r}
trainData8 = subtype_edata[trainRowNumbers$Resample08,]
testData8 = subtype_edata[-trainRowNumbers$Resample08,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData8[, 2:9285])
y= trainData8$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData8[, 2:9285])
y.test = testData8$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model8 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso8 = confusionMatrix(table.lasso.10fold)
full.lasso8
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full8 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full8
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA8 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA8 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model8 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso8 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso8
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso8 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso8
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model8 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso8 = confusionMatrix(table.nb.lasso)
nb.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso8 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso8
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model8 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso8 = confusionMatrix(table.rf.lasso)
rf.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso8 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso8
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model8 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso8 = confusionMatrix(table.gbm.lasso)
gbm.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso8 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso8
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model8 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso8 = confusionMatrix(table.knn.lasso)
knn.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso8 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso8
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model8 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso8 = confusionMatrix(table.svm.lasso)
svm.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso8 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso8
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model8 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso8 = confusionMatrix(table.nnet.lasso)
nnet.lasso8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso8 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso8
```

#/////CV fold 9 for Lasso features/////

```{r}
trainData9 = subtype_edata[trainRowNumbers$Resample09,]
testData9 = subtype_edata[-trainRowNumbers$Resample09,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData9[, 2:9285])
y= trainData9$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData9[, 2:9285])
y.test = testData9$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model9 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso9 = confusionMatrix(table.lasso.10fold)
full.lasso9
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full9 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full9
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA9 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA9 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model9 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso9 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso9
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso9 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso9
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model9 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso9 = confusionMatrix(table.nb.lasso)
nb.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso9 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso9
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model9 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso9 = confusionMatrix(table.rf.lasso)
rf.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso9 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso9
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model9 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso9 = confusionMatrix(table.gbm.lasso)
gbm.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso9 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso9
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model9 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso9 = confusionMatrix(table.knn.lasso)
knn.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso9 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso9
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model9 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso9 = confusionMatrix(table.svm.lasso)
svm.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso9 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso9
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model9 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso9 = confusionMatrix(table.nnet.lasso)
nnet.lasso9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso9 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso9
```

#/////CV fold 10 for Lasso features/////

```{r}
trainData10 = subtype_edata[trainRowNumbers$Resample10,]
testData10 = subtype_edata[-trainRowNumbers$Resample10,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData10[, 2:9285])
y= trainData10$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData10[, 2:9285])
y.test = testData10$SUBTYPE
y.test = as.factor(y.test)
```

# glmNET LASSO - Optimal performance on individual classification (Grouped data assessment not shown)

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.model10 = lasso.10fold
predict.lasso.10fold = predict(lasso.10fold, x.test, type="class")
table.lasso.10fold = table(predict.lasso.10fold, y.test)
full.lasso10 = confusionMatrix(table.lasso.10fold)
full.lasso10
```
```{r}
#Brier Score for Lasso
brier.lasso = predict(lasso.10fold, x.test, type="response")
brier.lasso = (brier.lasso)/rowSums(brier.lasso)
brier.lasso.full10 = multiclass.Brier(brier.lasso,y.test)
brier.lasso.full10
```
#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.min")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lassoTCGA10 = x.lasso

featuresextracted.lasso.test = as.data.frame(x.test) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso.test = as.matrix(featuresextracted.lasso.test)
x.lasso.testTCGA10 = x.lasso.test
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.lasso = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.lasso.model10 = lasso.lasso
predict.lasso.lasso = predict(lasso.lasso,x.lasso.test)
table.lasso.lasso = table(predict.lasso.lasso,y.test)
lasso.lasso10 = confusionMatrix(table.lasso.lasso, mode = "everything")
lasso.lasso10
```
```{r}
#Brier Score for Lasso
brier.lasso.lasso = predict(lasso.lasso, x.lasso.test, type="prob")
brier.lasso.lasso = (brier.lasso.lasso)/rowSums(brier.lasso.lasso)
brier.lasso.lasso10 = multiclass.Brier(brier.lasso.lasso,y.test)
brier.lasso.lasso10
```
#Naive Bayes with lasso features

```{r,warning=FALSE}
set.seed(99)
nb.lasso = caret::train(x.lasso,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.lasso.model10 = nb.lasso
predict.nb.lasso = predict(nb.lasso$finalModel,x.lasso.test)
table.nb.lasso = table(predict.nb.lasso,y.test)
nb.lasso10 = confusionMatrix(table.nb.lasso)
nb.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.lasso = predict(nb.lasso,newdata = x.lasso.test, type="prob")
brier.nb.lasso = (brier.nb.lasso)/rowSums(brier.nb.lasso)
brier.nb.lasso10 = multiclass.Brier(brier.nb.lasso,y.test)
brier.nb.lasso10
```

#RF with lasso features
```{r}
set.seed(99)
rf.lasso = caret::train(x.lasso,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.lasso.model10 = rf.lasso
predict.rf.lasso = predict(rf.lasso,x.lasso.test)
table.rf.lasso = table(predict.rf.lasso,y.test)
rf.lasso10 = confusionMatrix(table.rf.lasso)
rf.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.lasso = predict(rf.lasso,newdata = x.lasso.test, type="prob")
brier.rf.lasso = (brier.rf.lasso)/rowSums(brier.rf.lasso)
brier.rf.lasso10 = multiclass.Brier(brier.rf.lasso,y.test)
brier.rf.lasso10
```

#GBM with lasso features
```{r}
set.seed(99)
gbm.lasso = caret::train(x.lasso,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.lasso.model10 = gbm.lasso
predict.gbm.lasso = predict(gbm.lasso,x.lasso.test)
table.gbm.lasso = table(predict.gbm.lasso,y.test)
gbm.lasso10 = confusionMatrix(table.gbm.lasso)
gbm.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.lasso = predict(gbm.lasso,newdata = x.lasso.test, type="prob")
brier.gbm.lasso = (brier.gbm.lasso)/rowSums(brier.gbm.lasso)
brier.gbm.lasso10 = multiclass.Brier(brier.gbm.lasso,y.test)
brier.gbm.lasso10
```

#KNN
```{r}
set.seed(99)
knn.lasso = caret::train(x.lasso,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.lasso.model10 = knn.lasso
predict.knn.lasso = predict(knn.lasso,x.lasso.test)
table.knn.lasso = table(predict.knn.lasso,y.test)
knn.lasso10 = confusionMatrix(table.knn.lasso)
knn.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.lasso = predict(knn.lasso,newdata = x.lasso.test, type="prob")
brier.knn.lasso = (brier.knn.lasso)/rowSums(brier.knn.lasso)
brier.knn.lasso10 = multiclass.Brier(brier.knn.lasso,y.test)
brier.knn.lasso10
```

#SVM
```{r}
set.seed(99)
svm.lasso = caret::train(x.lasso,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.lasso.model10 = svm.lasso
predict.svm.lasso = predict(svm.lasso,x.lasso.test)
table.svm.lasso = table(predict.svm.lasso,y.test)
svm.lasso10 = confusionMatrix(table.svm.lasso)
svm.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.lasso = predict(svm.lasso,newdata = x.lasso.test, type="prob")
brier.svm.lasso = (brier.svm.lasso)/rowSums(brier.svm.lasso)
brier.svm.lasso10 = multiclass.Brier(brier.svm.lasso,y.test)
brier.svm.lasso10
```
#Neural Net
```{r}
set.seed(99)
nnet.lasso = caret::train(x.lasso,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.lasso.model10 = nnet.lasso
predict.nnet.lasso = predict(nnet.lasso,x.lasso.test)
table.nnet.lasso = table(predict.nnet.lasso,y.test)
nnet.lasso10 = confusionMatrix(table.nnet.lasso)
nnet.lasso10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.lasso = predict(nnet.lasso,newdata = x.lasso.test, type="prob")
brier.nnet.lasso = (brier.nnet.lasso)/rowSums(brier.nnet.lasso)
brier.nnet.lasso10 = multiclass.Brier(brier.nnet.lasso,y.test)
brier.nnet.lasso10
```

#FINISHED LASSO FEATURES MODEL SELECTION. 
#START GBM FEATURE SELECTION

#/////GBM CV fold 1 for GBM features/////
```{r}
trainData1 = subtype_edata[trainRowNumbers$Resample01,]
testData1 = subtype_edata[-trainRowNumbers$Resample01,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData1[, 2:9285])
y= trainData1$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData1[, 2:9285])
y.test = testData1$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model1 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature1 = confusionMatrix(table.gbm.feature)
gbm.feature1
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature1 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature1
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop1 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train1 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test1 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model1 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm1 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm1
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm1 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm1
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model1 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm1 = confusionMatrix(table.nb.gbm)
nb.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm1 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm1
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model1 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm1 = confusionMatrix(table.rf.gbm)
rf.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm1 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm1
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model1 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm1 = confusionMatrix(table.gbm.gbm)
gbm.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm1 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm1
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model1 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm1 = confusionMatrix(table.knn.gbm)
knn.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm1 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm1
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model1 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm1 = confusionMatrix(table.svm.gbm)
svm.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm1 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm1
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model1 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm1 = confusionMatrix(table.nnet.gbm)
nnet.gbm1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm1 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm1
```



#/////GBM CV fold 2 for GBM features/////
```{r}
trainData2 = subtype_edata[trainRowNumbers$Resample02,]
testData2 = subtype_edata[-trainRowNumbers$Resample02,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData2[, 2:9285])
y= trainData2$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData2[, 2:9285])
y.test = testData2$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model2 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature2 = confusionMatrix(table.gbm.feature)
gbm.feature2
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature2 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature2
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop2 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train2 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test2 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model2 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm2 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm2
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm2 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm2
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model2 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm2 = confusionMatrix(table.nb.gbm)
nb.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm2 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm2
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model2 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm2 = confusionMatrix(table.rf.gbm)
rf.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm2 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm2
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model2 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm2 = confusionMatrix(table.gbm.gbm)
gbm.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm2 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm2
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model2 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm2 = confusionMatrix(table.knn.gbm)
knn.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm2 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm2
```

#SVM with RF features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model2 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm2 = confusionMatrix(table.svm.gbm)
svm.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm2 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm2
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model2 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm2 = confusionMatrix(table.nnet.gbm)
nnet.gbm2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm2 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm2
```

#/////GBM CV fold 3 for GBM features/////
```{r}
trainData3 = subtype_edata[trainRowNumbers$Resample03,]
testData3 = subtype_edata[-trainRowNumbers$Resample03,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData3[, 2:9285])
y= trainData3$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData3[, 2:9285])
y.test = testData3$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model3 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature3 = confusionMatrix(table.gbm.feature)
gbm.feature3
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature3 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature3
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop3 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train3 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test3 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model3 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm3 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm3
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm3 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm3
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model3 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm3 = confusionMatrix(table.nb.gbm)
nb.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm3 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm3
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model3 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm3 = confusionMatrix(table.rf.gbm)
rf.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm3 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm3
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model3 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm3 = confusionMatrix(table.gbm.gbm)
gbm.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm3 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm3
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model3 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm3 = confusionMatrix(table.knn.gbm)
knn.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm3 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm3
```

#SVM with RF features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model3 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm3 = confusionMatrix(table.svm.gbm)
svm.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm3 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm3
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model3 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm3 = confusionMatrix(table.nnet.gbm)
nnet.gbm3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm3 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm3
```


#/////GBM CV fold 4 for GBM features/////
```{r}
trainData4 = subtype_edata[trainRowNumbers$Resample04,]
testData4 = subtype_edata[-trainRowNumbers$Resample04,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData4[, 2:9285])
y= trainData4$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData4[, 2:9285])
y.test = testData4$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model4 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature4 = confusionMatrix(table.gbm.feature)
gbm.feature4
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature4 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature4
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop4 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train4 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test4 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model4 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm4 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm4
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm4 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm4
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model4 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm4 = confusionMatrix(table.nb.gbm)
nb.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm4 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm4
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model4 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm4 = confusionMatrix(table.rf.gbm)
rf.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm4 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm4
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model4 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm4 = confusionMatrix(table.gbm.gbm)
gbm.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm4 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm4
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model4 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm4 = confusionMatrix(table.knn.gbm)
knn.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm4 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm4
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model4 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm4 = confusionMatrix(table.svm.gbm)
svm.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm4 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm4
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model4 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm4 = confusionMatrix(table.nnet.gbm)
nnet.gbm4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm4 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm4
```

#/////GBM CV fold 5 for GBM features/////
```{r}
trainData5 = subtype_edata[trainRowNumbers$Resample05,]
testData5 = subtype_edata[-trainRowNumbers$Resample05,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData5[, 2:9285])
y= trainData5$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData5[, 2:9285])
y.test = testData5$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model5 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature5 = confusionMatrix(table.gbm.feature)
gbm.feature5
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature5 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature5
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop5 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train5 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test5 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model5 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm5 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm5
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm5 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm5
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model5 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm5 = confusionMatrix(table.nb.gbm)
nb.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm5 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm5
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model5 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm5 = confusionMatrix(table.rf.gbm)
rf.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm5 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm5
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model5 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm5 = confusionMatrix(table.gbm.gbm)
gbm.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm5 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm5
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model5 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm5 = confusionMatrix(table.knn.gbm)
knn.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm5 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm5
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model5 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm5 = confusionMatrix(table.svm.gbm)
svm.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm5 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm5
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model5 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm5 = confusionMatrix(table.nnet.gbm)
nnet.gbm5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm5 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm5
```

#/////GBM CV fold 6 for GBM features/////
```{r}
trainData6 = subtype_edata[trainRowNumbers$Resample06,]
testData6 = subtype_edata[-trainRowNumbers$Resample06,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData6[, 2:9285])
y= trainData6$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData6[, 2:9285])
y.test = testData6$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model6 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature6 = confusionMatrix(table.gbm.feature)
gbm.feature6
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature6 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature6
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop6 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train6 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test6 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model6 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm6 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm6
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm6 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm6
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model6 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm6 = confusionMatrix(table.nb.gbm)
nb.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm6 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm6
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model6 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm6 = confusionMatrix(table.rf.gbm)
rf.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm6 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm6
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model6 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm6 = confusionMatrix(table.gbm.gbm)
gbm.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm6 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm6
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model6 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm6 = confusionMatrix(table.knn.gbm)
knn.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm6 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm6
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model6 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm6 = confusionMatrix(table.svm.gbm)
svm.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm6 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm6
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model6 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm6 = confusionMatrix(table.nnet.gbm)
nnet.gbm6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm6 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm6
```

#/////GBM CV fold 7 for GBM features/////
```{r}
trainData7 = subtype_edata[trainRowNumbers$Resample07,]
testData7 = subtype_edata[-trainRowNumbers$Resample07,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData7[, 2:9285])
y= trainData7$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData7[, 2:9285])
y.test = testData7$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model7 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature7 = confusionMatrix(table.gbm.feature)
gbm.feature7
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature7 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature7
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop7 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train7 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test7 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model7 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm7 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm7
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm7 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm7
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model7 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm7 = confusionMatrix(table.nb.gbm)
nb.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm7 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm7
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model7 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm7 = confusionMatrix(table.rf.gbm)
rf.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm7 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm7
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model7 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm7 = confusionMatrix(table.gbm.gbm)
gbm.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm7 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm7
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model7 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm7 = confusionMatrix(table.knn.gbm)
knn.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm7 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm7
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model7 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm7 = confusionMatrix(table.svm.gbm)
svm.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm7 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm7
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model7 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm7 = confusionMatrix(table.nnet.gbm)
nnet.gbm7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm7 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm7
```

#/////GBM CV fold 8 for GBM features/////
```{r}
trainData8 = subtype_edata[trainRowNumbers$Resample08,]
testData8 = subtype_edata[-trainRowNumbers$Resample08,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData8[, 2:9285])
y= trainData8$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData8[, 2:9285])
y.test = testData8$SUBTYPE
y.test = as.factor(y.test)
```

# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model8 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature8 = confusionMatrix(table.gbm.feature)
gbm.feature8
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature8 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature8
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop8 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train8 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test8 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model8 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm8 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm8
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm8 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm8
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model8 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm8 = confusionMatrix(table.nb.gbm)
nb.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm8 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm8
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model8 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm8 = confusionMatrix(table.rf.gbm)
rf.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm8 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm8
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model8 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm8 = confusionMatrix(table.gbm.gbm)
gbm.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm8 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm8
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model8 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm8 = confusionMatrix(table.knn.gbm)
knn.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm8 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm8
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model8 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm8 = confusionMatrix(table.svm.gbm)
svm.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm8 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm8
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model8 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm8 = confusionMatrix(table.nnet.gbm)
nnet.gbm8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm8 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm8
```

#/////GBM CV fold 9 for GBM features/////
```{r}
trainData9 = subtype_edata[trainRowNumbers$Resample09,]
testData9 = subtype_edata[-trainRowNumbers$Resample09,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData9[, 2:9285])
y= trainData9$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData9[, 2:9285])
y.test = testData9$SUBTYPE
y.test = as.factor(y.test)
```
# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model9 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature9 = confusionMatrix(table.gbm.feature)
gbm.feature9
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature9 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature9
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop9 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train9 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test9 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model9 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm9 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm9
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm9 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm9
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model9 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm9 = confusionMatrix(table.nb.gbm)
nb.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm9 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm9
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model9 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm9 = confusionMatrix(table.rf.gbm)
rf.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm9 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm9
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model9 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm9 = confusionMatrix(table.gbm.gbm)
gbm.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm9 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm9
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model9 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm9 = confusionMatrix(table.knn.gbm)
knn.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm9 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm9
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model9 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm9 = confusionMatrix(table.svm.gbm)
svm.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm9 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm9
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model9 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm9 = confusionMatrix(table.nnet.gbm)
nnet.gbm9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm9 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm9
```

#/////GBM CV fold 10 for GBM features/////
```{r}
trainData10 = subtype_edata[trainRowNumbers$Resample10,]
testData10 = subtype_edata[-trainRowNumbers$Resample10,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData10[, 2:9285])
y= trainData10$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData10[, 2:9285])
y.test = testData10$SUBTYPE
y.test = as.factor(y.test)
```

gbm# GBM feature selection 
```{r,warning=FALSE}
#Build model
set.seed(99)
gbm.feature = caret::train(x,y,'gbm',trControl=trainControl(method='cv',number=10, savePredictions = "final"))
gbm.feature.model10 = gbm.feature
predict.gbm.feature = predict(gbm.feature, newdata = x.test)
table.gbm.feature = table(predict.gbm.feature, y.test)
gbm.feature10 = confusionMatrix(table.gbm.feature)
gbm.feature10
```
```{r}
#Brier Score
brier.gbm.feature = predict(gbm.feature, newdata = x.test, type="prob")
brier.gbm.feature = brier.gbm.feature/rowSums(brier.gbm.feature)
brier.gbm.feature10 = multiclass.Brier(brier.gbm.feature,y.test)
brier.gbm.feature10
```
# Variable importance according to random forest with all features
```{r,warning=FALSE} 
gbm_features = varImp(gbm.feature)

gbmtop50 = gbm_features$importance %>% filter(rank(desc(gbm_features$importance))<=50)
gbmtop10 = gbmtop50
```

```{r}
plot(gbm_features, top=20)
```

#Data set with extracted top 50 features from gbm
```{r,warning=FALSE}
rntop50 = row.names(gbmtop50)

gbm.train =as.data.frame(x) %>% dplyr::select(all_of((rntop50)))
gbm.train10 = gbm.train

gbm.test = as.data.frame(x.test) %>% dplyr::select(all_of(rntop50))
gbm.test10 = gbm.test
```

#Lasso with gbm features 
```{r}
set.seed(99)
lasso.gbm = caret::train(gbm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.gbm.model10 = lasso.gbm
predict.lasso.gbm = predict(lasso.gbm,gbm.test)
table.lasso.gbm = table(predict.lasso.gbm,y.test)
lasso.gbm10 = confusionMatrix(table.lasso.gbm, mode = "everything")
lasso.gbm10
```
```{r}
#Brier Score for Lasso
brier.lasso.gbm = predict(lasso.gbm, gbm.test, type="prob")
brier.lasso.gbm = (brier.lasso.gbm)/rowSums(brier.lasso.gbm)
brier.lasso.gbm10 = multiclass.Brier(brier.lasso.gbm,y.test)
brier.lasso.gbm10
```
#Naive Bayes with GBM features

```{r,warning=FALSE}
set.seed(99)
nb.gbm = caret::train(gbm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.gbm.model10 = nb.gbm
predict.nb.gbm = predict(nb.gbm,gbm.test)
table.nb.gbm = table(predict.nb.gbm,y.test)
nb.gbm10 = confusionMatrix(table.nb.gbm)
nb.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.gbm = predict(nb.gbm,newdata = gbm.test, type="prob")
brier.nb.gbm = (brier.nb.gbm)/rowSums(brier.nb.gbm)
brier.nb.gbm10 = multiclass.Brier(brier.nb.gbm,y.test)
brier.nb.gbm10
```

#RF with GBM features
```{r}
set.seed(99)
rf.gbm = caret::train(gbm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.gbm.model10 = rf.gbm
predict.rf.gbm = predict(rf.gbm,gbm.test)
table.rf.gbm = table(predict.rf.gbm,y.test)
rf.gbm10 = confusionMatrix(table.rf.gbm)
rf.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.gbm = predict(rf.gbm,newdata = gbm.test, type="prob")
brier.rf.gbm = (brier.rf.gbm)/rowSums(brier.rf.gbm)
brier.rf.gbm10 = multiclass.Brier(brier.rf.gbm,y.test)
brier.rf.gbm10
```

#GBM with GBM features
```{r}
set.seed(99)
gbm.gbm = caret::train(gbm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.gbm.model10 = gbm.gbm
predict.gbm.gbm = predict(gbm.gbm,gbm.test)
table.gbm.gbm = table(predict.gbm.gbm,y.test)
gbm.gbm10 = confusionMatrix(table.gbm.gbm)
gbm.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.gbm = predict(gbm.gbm,newdata = gbm.test, type="prob")
brier.gbm.gbm = (brier.gbm.gbm)/rowSums(brier.gbm.gbm)
brier.gbm.gbm10 = multiclass.Brier(brier.gbm.gbm,y.test)
brier.gbm.gbm10
```

#KNN with GBM features
```{r}
set.seed(99)
knn.gbm = caret::train(gbm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.gbm.model10 = knn.gbm
predict.knn.gbm = predict(knn.gbm,gbm.test)
table.knn.gbm = table(predict.knn.gbm,y.test)
knn.gbm10 = confusionMatrix(table.knn.gbm)
knn.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.gbm = predict(knn.gbm,newdata = gbm.test, type="prob")
brier.knn.gbm = (brier.knn.gbm)/rowSums(brier.knn.gbm)
brier.knn.gbm10 = multiclass.Brier(brier.knn.gbm,y.test)
brier.knn.gbm10
```

#SVM with GBM features
```{r}
set.seed(99)
svm.gbm = caret::train(gbm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3, classProbs = TRUE))
svm.gbm.model10 = svm.gbm
predictsvm.gbm = predict(svm.gbm,gbm.test)
table.svm.gbm = table(predictsvm.gbm,y.test)
svm.gbm10 = confusionMatrix(table.svm.gbm)
svm.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.gbm = predict(svm.gbm,newdata = gbm.test, type="prob")
brier.svm.gbm = (brier.svm.gbm)/rowSums(brier.svm.gbm)
brier.svm.gbm10 = multiclass.Brier(brier.svm.gbm,y.test)
brier.svm.gbm10
```
#Neural Net
```{r}
set.seed(99)
nnet.gbm = caret::train(gbm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.gbm.model10 = nnet.gbm
predict.nnet.gbm = predict(nnet.gbm,gbm.test)
table.nnet.gbm = table(predict.nnet.gbm,y.test)
nnet.gbm10 = confusionMatrix(table.nnet.gbm)
nnet.gbm10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.gbm = predict(nnet.gbm,newdata = gbm.test, type="prob")
brier.nnet.gbm = (brier.nnet.gbm)/rowSums(brier.nnet.gbm)
brier.nnet.gbm10 = multiclass.Brier(brier.nnet.gbm,y.test)
brier.nnet.gbm10
```

#END GBM FEATURE SELECTION
#START SVM FEATURE SELECTION

#/////CV Fold 1 SVM Features/////

```{r}
trainData1 = subtype_edata[trainRowNumbers$Resample01,]
testData1 = subtype_edata[-trainRowNumbers$Resample01,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData1[, 2:9285])
y= trainData1$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData1[, 2:9285])
y.test = testData1$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model1 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA1 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA1 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA1
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA1 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA1 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model1 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA1 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA1
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm1 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm1
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model1 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA1 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm1 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm1
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model1 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA1 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm1 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm1
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model1 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA1 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso1 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso1
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model1 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA1 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso1 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso1
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model1 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA1 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm1 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm1
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model1 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA1 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA1
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnect.TCGA.svm)
brier.nnet.TCGA.svm1 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm1
```


#/////CV Fold 2 SVM Features/////

```{r}
trainData2 = subtype_edata[trainRowNumbers$Resample02,]
testData2 = subtype_edata[-trainRowNumbers$Resample02,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData2[, 2:9285])
y= trainData2$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData2[, 2:9285])
y.test = testData2$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model2 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA2 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA2 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA2
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA2 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA2 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model2 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA2 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA2
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm2 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm2
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model2 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA2 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm2 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm2
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model2 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA2 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm2 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm2
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model2 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA2 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso2 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso2
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model2 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA2 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso2 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso2
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model2 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA2 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm2 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm2
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model2 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA2 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA2
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm2 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm2
```


#/////CV Fold 3 SVM Features/////

```{r}
trainData3 = subtype_edata[trainRowNumbers$Resample03,]
testData3 = subtype_edata[-trainRowNumbers$Resample03,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData3[, 2:9285])
y= trainData3$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData3[, 2:9285])
y.test = testData3$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model3 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA3 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA3 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA3
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA3 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA3 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model3 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA3 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA3
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm3 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm3
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model3 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA3 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm3 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm3
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model3 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA3 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm3 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm3
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model3 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA3 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso3 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso3
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model3 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA3 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso3 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso3
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model3 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA3 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm3 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm3
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model3 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA3 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA3
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm3 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm3
```


#/////CV Fold 4 SVM Features/////

```{r}
trainData4 = subtype_edata[trainRowNumbers$Resample04,]
testData4 = subtype_edata[-trainRowNumbers$Resample04,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData4[, 2:9285])
y= trainData4$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData4[, 2:9285])
y.test = testData4$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model4 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA4 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA4 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA4
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA4 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA4 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model4 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA4 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA4
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm4 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm4
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model4 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA4 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm4 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm4
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model4 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA4 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm4 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm4
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model4 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA4 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso4 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso4
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model4 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA4 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso4 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso4
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model4 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA4 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm4 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm4
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model4 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA4 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA4
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm4 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm4
```


#/////CV Fold 5 SVM Features/////

```{r}
trainData5 = subtype_edata[trainRowNumbers$Resample05,]
testData5 = subtype_edata[-trainRowNumbers$Resample05,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData5[, 2:9285])
y= trainData5$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData5[, 2:9285])
y.test = testData5$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model5 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA5 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA5 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA5
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA5 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA5 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model5 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA5 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA5
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm5 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm5
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model5 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA5 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm5 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm5
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model5 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA5 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm5 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm5
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model5 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA5 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso5 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso5
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model5 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA5 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso5 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso5
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model5 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA5 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm5 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm5
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model5 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA5 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA5
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm5 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm5
```


#/////CV Fold 6 SVM Features/////

```{r}
trainData6 = subtype_edata[trainRowNumbers$Resample06,]
testData6 = subtype_edata[-trainRowNumbers$Resample06,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData6[, 2:9285])
y= trainData6$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData6[, 2:9285])
y.test = testData6$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model6 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA6 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA6 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA6
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA6 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA6 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model6 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA6 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA6
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm6 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm6
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model6 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA6 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm6 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm6
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model6 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA6 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm6 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm6
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model6 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA6 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso6 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso6
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model6 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA6 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso6 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso6
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model6 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA6 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm6 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm6
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model6 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA6 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA6
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm6 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm6
```


#/////CV Fold 7 SVM Features/////

```{r}
trainData7 = subtype_edata[trainRowNumbers$Resample07,]
testData7 = subtype_edata[-trainRowNumbers$Resample07,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData7[, 2:9285])
y= trainData7$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData7[, 2:9285])
y.test = testData7$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model7 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA7 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA7 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA7
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA7 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA7 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model6 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA7 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA7
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm7 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm7
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model7 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA7 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm7 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm7
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model7 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA7 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm7 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm7
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model7 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA7 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso7 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso7
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model7 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA7 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso7 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso7
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model7 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA7 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm7 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm7
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model7 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA7 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA7
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm7 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm7
```

#/////CV Fold 8 SVM Features/////

```{r}
trainData8 = subtype_edata[trainRowNumbers$Resample08,]
testData8 = subtype_edata[-trainRowNumbers$Resample08,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData8[, 2:9285])
y= trainData8$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData8[, 2:9285])
y.test = testData8$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model8 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA8 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA8 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA8
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA8 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA8 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model8 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA8 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA8
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm8 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm8
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model8 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA8 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm8 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm8
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model8 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA8 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm8 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm8
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model8 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA8 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso8 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso8
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model8 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA8 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso8 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso8
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model8 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA8 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm8 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm8
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model8 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA8 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA8
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm8 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm8
```

#/////CV Fold 9 SVM Features/////

```{r}
trainData9 = subtype_edata[trainRowNumbers$Resample09,]
testData9 = subtype_edata[-trainRowNumbers$Resample09,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData9[, 2:9285])
y= trainData9$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData9[, 2:9285])
y.test = testData9$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model9 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA9 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA9 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA9
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA9 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA9 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model9 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA9 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA9
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm9 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm9
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model9 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA9 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm9 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm9
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model9 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA9 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm9 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm9
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model9 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA9 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso9 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso9
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model9 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA9 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso9 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso9
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model9 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA9 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm9 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm9
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model9 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA9 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA9
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm9 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm9
```

#/////CV Fold 10 SVM Features/////

```{r}
trainData10 = subtype_edata[trainRowNumbers$Resample10,]
testData10 = subtype_edata[-trainRowNumbers$Resample10,]
```
```{r}
#Make our test and train data
x=data.matrix(trainData10[, 2:9285])
y= trainData10$SUBTYPE
y = as.factor(y)
x.test= data.matrix(testData10[, 2:9285])
y.test = testData10$SUBTYPE
y.test = as.factor(y.test)
```

#SVM for feature selections
```{r}
set.seed(99)
svm.TCGA = caret::train(x,y,'svmLinear2',trControl=trainControl(method='cv',number=10,classProbs = TRUE))
svm.TCGA.model10 = svm.TCGA
predict.svm.TCGA = predict(svm.TCGA,x.test)
table.svm.TCGA = table(predict.svm.TCGA,y.test)
full.svm.TCGA10 = confusionMatrix(table.svm.TCGA)
full.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA = predict(svm.TCGA,newdata = x.test, type = "prob")
brier.svm.TCGA = (brier.svm.TCGA)/rowSums(brier.svm.TCGA)
brier.svm.TCGA10 = multiclass.Brier(brier.svm.TCGA,y.test)
brier.svm.TCGA10
```
# Variable importance according to svm with all features
```{r,warning=FALSE} 
svm.features = varImp(svm.TCGA)
svm.features = svm.features$importance
STAD_CIN.svm = dplyr::select(svm.features, "STAD_CIN")
STAD_CIN.svm = STAD_CIN.svm %>% filter(rank(desc(STAD_CIN.svm))<=15)
STAD_EBV.svm = dplyr::select(svm.features, "STAD_EBV")
STAD_EBV.svm = STAD_EBV.svm %>% filter(rank(desc(STAD_EBV.svm))<=15)
STAD_GS.svm = dplyr::select(svm.features, "STAD_GS")
STAD_GS.svm = STAD_GS.svm %>% filter(rank(desc(STAD_GS.svm))<=15)
STAD_MSI.svm = dplyr::select(svm.features, "STAD_MSI")
STAD_MSI.svm = STAD_MSI.svm %>% filter(rank(desc(STAD_MSI.svm))<=15)
```
```{r}
STAD_CIN.svm = row.names(STAD_CIN.svm)
STAD_EBV.svm = row.names(STAD_EBV.svm)
STAD_GS.svm = row.names(STAD_GS.svm)
STAD_MSI.svm = row.names(STAD_MSI.svm)
```
```{r}
#Combine top features and remove duplicated 
svm.topfeatures = append(STAD_CIN.svm,STAD_EBV.svm)
svm.topfeatures = append(svm.topfeatures,STAD_GS.svm)
svm.topfeatures = append(svm.topfeatures,STAD_MSI.svm)
svm.topfeatures=as.data.frame(svm.topfeatures)
svm.topfeatures = svm.topfeatures[!duplicated(svm.topfeatures),]
```
#Data set with extracted top features from svm
```{r,warning=FALSE}
svm.train =as.data.frame(x) %>% dplyr::select(all_of((svm.topfeatures)))
svm.train.TCGA10 = svm.train

svm.test = as.data.frame(x.test) %>% dplyr::select(all_of(svm.topfeatures))
svm.train.TCGA10 = svm.test
```

#Lasso with svm features
```{r}
set.seed(99)
lasso.svm.TCGA = caret::train(svm.train,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
lasso.svm.TCGA.model10 = lasso.svm.TCGA
predict.lasso.svm.TCGA = predict(lasso.svm.TCGA,svm.test)
table.lasso.svm.TCGA = table(predict.lasso.svm.TCGA,y.test)
lasso.svm.TCGA10 = confusionMatrix(table.lasso.svm.TCGA, mode = "everything")
lasso.svm.TCGA10
```
```{r}
#Brier Score for Lasso
brier.lasso.TCGA.svm = predict(lasso.svm.TCGA, svm.test, type="prob")
brier.lasso.TCGA.svm = (brier.lasso.TCGA.svm)/rowSums(brier.lasso.TCGA.svm)
brier.lasso.TCGA.svm10 = multiclass.Brier(brier.lasso.TCGA.svm,y.test)
brier.lasso.TCGA.svm10
```
#Naive Bayes with svm features

```{r,warning=FALSE}
set.seed(99)
nb.svm.TCGA = caret::train(svm.train,y,'naive_bayes',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
nb.svm.TCGA.model10 = nb.svm.TCGA
predict.nb.svm.TCGA = predict(nb.svm.TCGA$finalModel,svm.test)
table.nb.svm.TCGA = table(predict.nb.svm.TCGA,y.test)
nb.svm.TCGA10 = confusionMatrix(table.nb.svm.TCGA)
nb.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.nb.TCGA.svm = predict(nb.svm.TCGA,newdata = svm.test, type="prob")
brier.nb.TCGA.svm = (brier.nb.TCGA.svm)/rowSums(brier.nb.TCGA.svm)
brier.nb.TCGA.svm10 = multiclass.Brier(brier.nb.TCGA.svm,y.test)
brier.nb.TCGA.svm10
```


#RF with svm features
```{r}
set.seed(99)
rf.svm.TCGA = caret::train(svm.train,y,'rf',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
rf.svm.TCGA.model10 = rf.svm.TCGA
predict.rf.svm.TCGA= predict(rf.svm.TCGA,svm.test)
table.rf.svm.TCGA = table(predict.rf.svm.TCGA,y.test)
rf.svm.TCGA10 = confusionMatrix(table.rf.svm.TCGA)
rf.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.rf.TCGA.svm = predict(rf.svm.TCGA,newdata = svm.test, type="prob")
brier.rf.TCGA.svm = (brier.rf.TCGA.svm)/rowSums(brier.rf.TCGA.svm)
brier.rf.TCGA.svm10 = multiclass.Brier(brier.rf.TCGA.svm,y.test)
brier.rf.TCGA.svm10
```

#GBM with svm features
```{r}
set.seed(99)
gbm.svm.TCGA = caret::train(svm.train,y,'gbm',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
gbm.svm.TCGA.model10 = gbm.svm.TCGA
predict.gbm.svm.TCGA = predict(gbm.svm.TCGA,svm.test)
table.gbm.svm.TCGA = table(predict.gbm.svm.TCGA,y.test)
gbm.svm.TCGA10 = confusionMatrix(table.gbm.svm.TCGA)
gbm.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.gbm.TCGA.lasso = predict(gbm.svm.TCGA,newdata = svm.test, type="prob")
brier.gbm.TCGA.lasso = (brier.gbm.TCGA.lasso)/rowSums(brier.gbm.TCGA.lasso)
brier.gbm.TCGA.lasso10 = multiclass.Brier(brier.gbm.TCGA.lasso,y.test)
brier.gbm.TCGA.lasso10
```

#KNN with svm Features
```{r}
set.seed(99)
knn.svm.TCGA = caret::train(svm.train,y,'knn',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(k=c(3,6,9,12,15)))
knn.svm.TCGA.model10 = knn.svm.TCGA
predict.knn.svm.TCGA = predict(knn.svm.TCGA,svm.test)
table.knn.svm.TCGA = table(predict.knn.svm.TCGA,y.test)
knn.svm.TCGA10 = confusionMatrix(table.knn.svm.TCGA)
knn.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.knn.TCGA.lasso = predict(knn.svm.TCGA,newdata = svm.test, type="prob")
brier.knn.TCGA.lasso = (brier.knn.TCGA.lasso)/rowSums(brier.knn.TCGA.lasso)
brier.knn.TCGA.lasso10 = multiclass.Brier(brier.knn.TCGA.lasso,y.test)
brier.knn.TCGA.lasso10
```

#SVM wtih svm features
```{r}
set.seed(99)
svm.svm.TCGA = caret::train(svm.train,y,'svmLinear2',trControl=trainControl(method='repeatedcv',number=5, repeats = 3,classProbs = TRUE))
svm.svm.TCGA.model10 = svm.svm.TCGA
predict.svm.svm.TCGA = predict(svm.svm.TCGA,svm.test)
table.svm.svm.TCGA = table(predict.svm.svm.TCGA,y.test)
svm.svm.TCGA10 = confusionMatrix(table.svm.svm.TCGA)
svm.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.svm.TCGA.svm = predict(svm.svm.TCGA,newdata = svm.test, type = "prob")
brier.svm.TCGA.svm = (brier.svm.TCGA.svm)/rowSums(brier.svm.TCGA.svm)
brier.svm.TCGA.svm10 = multiclass.Brier(brier.svm.TCGA.svm,y.test)
brier.svm.TCGA.svm10
```

#Neural Net with svm features
```{r}
set.seed(99)
nnet.svm.TCGA = caret::train(svm.train,y,'nnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3),tuneGrid = expand.grid(decay = c(1,0.5,0,1e-1,1e-4),size = c(1, 3, 5, 7)))
nnet.svm.TCGA.model10 = nnet.svm.TCGA
predict.nnet.svm.TCGA = predict(nnet.svm.TCGA,svm.test)
table.nnet.svm.TCGA = table(predict.nnet.svm.TCGA,y.test)
nnet.svm.TCGA10 = confusionMatrix(table.nnet.svm.TCGA)
nnet.svm.TCGA10
```
```{r,warning=FALSE}
#Brier Score
brier.nnet.TCGA.svm = predict(nnet.svm.TCGA,newdata = svm.test, type="prob")
brier.nnet.TCGA.svm = (brier.nnet.TCGA.svm)/rowSums(brier.nnet.TCGA.svm)
brier.nnet.TCGA.svm10 = multiclass.Brier(brier.nnet.TCGA.svm,y.test)
brier.nnet.TCGA.svm10
```

#END SVM


#Extract top features from top model

```{r}
#Top model 
lasso.lasso.model8
```
```{r}
TCGA_finalfeatures = colnames(x.lassoTCGA8)
TCGA_finalfeatures
```
```{r}
plot(varImp(lasso.lasso.model8), top=20)
```
```{r}
varImp(lasso.lasso.model8)[["importance"]]

```

#Train final model 

```{r}
#Make our test and train data
x= data.matrix(subtype_edata[, 2:9285])
y= subtype_edata$SUBTYPE
y = as.factor(y)
```

```{r}
set.seed(99)
lasso.10fold = cv.glmnet(x,y,family="multinomial", nfolds=10)
lasso.10fold.final = lasso.10fold
```

#Extract features
```{r}
coef.lasso.10fold = coef(lasso.10fold, s="lambda.1se")
```
```{r}
featuresextracted.lasso = as.data.frame(x) %>% dplyr::select(coef.lasso.10fold[["STAD_CIN"]]@i,coef.lasso.10fold[["STAD_EBV"]]@i,coef.lasso.10fold[["STAD_GS"]]@i,coef.lasso.10fold[["STAD_MSI"]]@i)

x.lasso = as.matrix(featuresextracted.lasso)
x.lasso.final = x.lasso
TCGA_target_distribution=x.lasso.final
```

#Lasso with lasso features
```{r}
set.seed(99)
lasso.final = caret::train(x.lasso,y,'glmnet',trControl=trainControl(method='repeatedcv',number=5, repeats = 3))
TCGA.finalmodel = lasso.final
```
```{r}
TCGAfinalgenes = colnames(featuresextracted.lasso)
```
```{r}
library(xlsx)
write.xlsx(TCGAfinalgenes,file = "TCGA final genes.xlsx", sheetName = "TCGA genes")
```

#Compile Model Metrics
#Lasso compile
```{r}
#Full lasso
total_list <- lapply(mget(ls(pattern = 'full.lasso\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models1 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models1) <- c("Accuracy", "Kappa")
tcga_models1$Brier_score = mget(ls(pattern = 'brier.lasso.full\\d+'))
tcga_models1$Model <- 'Full Elastic Net'
tcga_models1$FS <- 'Full'
remove(total_list)


#Lasso lasso
total_list <- mget(ls(pattern = 'lasso.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models2 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models2) <- c("Accuracy", "Kappa")
tcga_models2$Brier_score = mget(ls(pattern = 'brier.lasso.lasso\\d+'))
tcga_models2$Model <- 'Elastic Net Elastic Net'
tcga_models2$FS <- 'Elastic Net'
tcga_models2 = dplyr::select(tcga_models2, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NB lasso
total_list <- mget(ls(pattern = 'nb.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models3 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models3) <- c("Accuracy", "Kappa")
tcga_models3$Brier_score = mget(ls(pattern = 'brier.nb.lasso\\d+'))
tcga_models3$Model <- 'NB Elastic Net'
tcga_models3$FS <- 'Elastic Net'
tcga_models3 = dplyr::select(tcga_models3, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)


#RF lasso
total_list <- mget(ls(pattern = 'rf.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models4 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models4) <- c("Accuracy", "Kappa")
tcga_models4$Brier_score = mget(ls(pattern = 'brier.rf.lasso\\d+'))
tcga_models4$Model <- 'RF Elastic Net'
tcga_models4$FS <- 'Elastic Net'
tcga_models4 = dplyr::select(tcga_models4, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#GBM lasso
total_list <- mget(ls(pattern = 'gbm.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models5 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models5) <- c("Accuracy", "Kappa")
tcga_models5$Brier_score = mget(ls(pattern = 'brier.gbm.lasso\\d+'))
tcga_models5$Model <- 'GBM Elastic Net'
tcga_models5$FS <- 'Elastic Net'
tcga_models5 = dplyr::select(tcga_models5, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#KNN lasso
total_list <- mget(ls(pattern = 'knn.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models6 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models6) <- c("Accuracy", "Kappa")
tcga_models6$Brier_score = mget(ls(pattern = 'brier.knn.lasso\\d+'))
tcga_models6$Model <- 'KNN Elastic Net'
tcga_models6$FS <- 'Elastic Net'
tcga_models6 = dplyr::select(tcga_models6, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#SVM lasso
total_list <- mget(ls(pattern = 'svm.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models7 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models7) <- c("Accuracy", "Kappa")
tcga_models7$Brier_score = mget(ls(pattern = 'brier.svm.lasso\\d+'))
tcga_models7$Model <- 'SVM Elastic Net'
tcga_models7$FS <- 'Elastic Net'
tcga_models7 = dplyr::select(tcga_models7, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NNET lasso
total_list <- mget(ls(pattern = 'nnet.lasso\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models8 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models8) <- c("Accuracy", "Kappa")
tcga_models8$Brier_score = mget(ls(pattern = 'brier.nnet.lasso\\d+'))
tcga_models8$Model <- 'NNET Elastic Net'
tcga_models8$FS <- 'Elastic Net'
tcga_models8 = dplyr::select(tcga_models8, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)



```
#GBM compile
```{r}
#GBM feature selection
total_list <- mget(ls(pattern = 'gbm.feature\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models9 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models9) <- c("Accuracy", "Kappa")
tcga_models9$Brier_score = mget(ls(pattern = 'brier.gbm.feature\\d+'))
tcga_models9$Model <- 'Full GBM'
tcga_models9$FS <- 'Full'
tcga_models9 = dplyr::select(tcga_models9, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#Lasso GBM selection
total_list <- mget(ls(pattern = 'lasso.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models10 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models10) <- c("Accuracy", "Kappa")
tcga_models10$Brier_score = mget(ls(pattern = 'brier.lasso.gbm\\d+'))
tcga_models10$Model <- 'Elastic Net GBM'
tcga_models10$FS <- 'GBM'
tcga_models10 = dplyr::select(tcga_models10, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NB GBM
total_list <- mget(ls(pattern = 'nb.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models11 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models11) <- c("Accuracy", "Kappa")
tcga_models11$Brier_score = mget(ls(pattern = 'brier.nb.gbm\\d+'))
tcga_models11$Model <- 'NB GBM'
tcga_models11$FS <- 'GBM'
tcga_models11 = dplyr::select(tcga_models11, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#RF GBM
total_list <- mget(ls(pattern = 'rf.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models12 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models12) <- c("Accuracy", "Kappa")
tcga_models12$Brier_score = mget(ls(pattern = 'brier.rf.gbm\\d+'))
tcga_models12$Model <- 'RF GBM'
tcga_models12$FS <- 'GBM'
tcga_models12 = dplyr::select(tcga_models12, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#GBM GBM
total_list <- mget(ls(pattern = 'gbm.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models13 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models13) <- c("Accuracy", "Kappa")
tcga_models13$Brier_score = mget(ls(pattern = 'brier.gbm.gbm\\d+'))
tcga_models13$Model <- 'GBM GBM'
tcga_models13$FS <- 'GBM'
tcga_models13 = dplyr::select(tcga_models13, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#KNN GBM
total_list <- mget(ls(pattern = 'knn.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models14 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models14) <- c("Accuracy", "Kappa")
tcga_models14$Brier_score = mget(ls(pattern = 'brier.knn.gbm\\d+'))
tcga_models14$Model <- 'KNN GBM'
tcga_models14$FS <- 'GBM'
tcga_models14 = dplyr::select(tcga_models14, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#SVM GBM
total_list <- mget(ls(pattern = 'svm.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models15 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models15) <- c("Accuracy", "Kappa")
tcga_models15$Brier_score = mget(ls(pattern = 'brier.svm.gbm\\d+'))
tcga_models15$Model <- 'SVM GBM'
tcga_models15$FS <- 'GBM'
tcga_models15 = dplyr::select(tcga_models15, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

#NNET GBM
total_list <- mget(ls(pattern = 'nnet.gbm\\d+'))
total_list <- lapply(total_list, '[','overall')
total_list = total_list[-c(1:10)]
tcga_models16 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models16) <- c("Accuracy", "Kappa")
tcga_models16$Brier_score = mget(ls(pattern = 'brier.nnet.gbm\\d+'))
tcga_models16$Model <- 'NNET GBM'
tcga_models16$FS <- 'GBM'
tcga_models16 = dplyr::select(tcga_models16, c("Accuracy", "Kappa", "Brier_score", "Model", "FS"))
remove(total_list)

```
#SVM compile
```{r}
#SVM feature selection
total_list <- lapply(mget(ls(pattern = 'full.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models17 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models17) <- c("Accuracy", "Kappa")
tcga_models17$Brier_score = mget(ls(pattern = 'brier.svm.TCGA\\d+'))
tcga_models17$Model <- 'Full SVM'
tcga_models17$FS <- 'Full'
remove(total_list)


#Lasso SVM selection
total_list <- lapply(mget(ls(pattern = 'lasso.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models18 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models18) <- c("Accuracy", "Kappa")
tcga_models18$Brier_score = mget(ls(pattern = 'brier.lasso.TCGA.svm\\d+'))
tcga_models18$Model <- 'Elastic Net SVM'
tcga_models18$FS <- 'SVM'
remove(total_list)

#NB SVM
total_list <- lapply(mget(ls(pattern = 'nb.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models19 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models19) <- c("Accuracy", "Kappa")
tcga_models19$Brier_score = mget(ls(pattern = 'brier.nb.TCGA.svm\\d+'))
tcga_models19$Model <- 'NB SVM'
tcga_models19$FS <- 'SVM'
remove(total_list)

#RF SVM
total_list <- lapply(mget(ls(pattern = 'rf.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models20 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models20) <- c("Accuracy", "Kappa")
tcga_models20$Brier_score = mget(ls(pattern = 'brier.rf.TCGA.svm\\d+'))
tcga_models20$Model <- 'RF SVM'
tcga_models20$FS <- 'SVM'
remove(total_list)


#GBM SVM
total_list <- lapply(mget(ls(pattern = 'gbm.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models21 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models21) <- c("Accuracy", "Kappa")
tcga_models21$Brier_score = mget(ls(pattern = 'brier.gbm.TCGA.lasso\\d+'))
tcga_models21$Model <- 'GBM SVM'
tcga_models21$FS <- 'SVM'
remove(total_list)

#KNN SVM
total_list <- lapply(mget(ls(pattern = 'knn.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models22 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models22) <- c("Accuracy", "Kappa")
tcga_models22$Brier_score = mget(ls(pattern = 'brier.knn.TCGA.lasso\\d+'))
tcga_models22$Model <- 'KNN SVM'
tcga_models22$FS <- 'SVM'
remove(total_list)

#SVM SVM
total_list <- lapply(mget(ls(pattern = 'svm.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models23 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models23) <- c("Accuracy", "Kappa")
tcga_models23$Brier_score = mget(ls(pattern = 'brier.svm.TCGA.svm\\d+'))
tcga_models23$Model <- 'SVM SVM'
tcga_models23$FS <- 'SVM'
remove(total_list)

#NNET GBM
total_list <- lapply(mget(ls(pattern = 'nnet.svm.TCGA\\d+')), function(x) {
         data <- x$overall
         data[setdiff(names(data), c("AccuracyLower","AccuracyUpper", "AccuracyNull", "AccuracyPValue", "McnemarPValue" ))]
})
tcga_models24 <- data.frame(matrix(unlist(total_list), nrow=length(total_list), byrow=TRUE))
colnames(tcga_models24) <- c("Accuracy", "Kappa")
tcga_models24$Brier_score = mget(ls(pattern = 'brier.nnet.TCGA.svm\\d+'))
tcga_models24$Model <- 'NNET SVM'
tcga_models24$FS <- 'SVM'
remove(total_list)


```

#Export data dataframe
```{r}
write.csv(compile_tcga_model,file = "compile_tcga_model.csv")
write.csv(compile_tcga_model_long,file = "compile_tcga_model_long.csv")
```




#Compile per type Model Metrics
#Lasso compile
```{r}
#Full lasso
total_list <- lapply(mget(ls(pattern = 'full.lasso\\d+')), function(x) {
         data <- x$byClass})
tcga_class1 = melt(total_list)
tcga_class1 = summarySE(tcga_class1, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class1 = dplyr::select(tcga_class1, -c("N","se", "ci"))
tcga_class1 = reshape(tcga_class1,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class1$Model = "Full Elastic Net"
remove(total_list)

#Lasso lasso
total_list <- mget(ls(pattern = 'lasso.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class2 = melt(total_list)
tcga_class2 = summarySE(tcga_class2, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class2 = dplyr::select(tcga_class2, -c("N","se", "ci"))
tcga_class2 = reshape(tcga_class2,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class2$Model = "Elastic Net Elastic Net"
remove(total_list)

#NB lasso
total_list <- mget(ls(pattern = 'nb.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class3 = melt(total_list)
tcga_class3 = summarySE(tcga_class3, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class3 = dplyr::select(tcga_class3, -c("N","se", "ci"))
tcga_class3 = reshape(tcga_class3,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class3$Model = "NB Elastic Net"
remove(total_list)


#RF lasso
total_list <- mget(ls(pattern = 'rf.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class4 = melt(total_list)
tcga_class4 = summarySE(tcga_class4, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class4 = dplyr::select(tcga_class4, -c("N","se", "ci"))
tcga_class4 = reshape(tcga_class4,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class4$Model = "RF Elastic Net"
remove(total_list)


#GBM lasso
total_list <- mget(ls(pattern = 'gbm.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class5 = melt(total_list)
tcga_class5 = summarySE(tcga_class5, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class5 = dplyr::select(tcga_class5, -c("N","se", "ci"))
tcga_class5 = reshape(tcga_class5,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class5$Model = "GBM Elastic Net"
remove(total_list)


#KNN lasso
total_list <- mget(ls(pattern = 'knn.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class6 = melt(total_list)
tcga_class6 = summarySE(tcga_class6, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class6 = dplyr::select(tcga_class6, -c("N","se", "ci"))
tcga_class6 = reshape(tcga_class6,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class6$Model = "KNN Elastic Net"
remove(total_list)

#SVM lasso
total_list <- mget(ls(pattern = 'svm.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class7 = melt(total_list)
tcga_class7 = summarySE(tcga_class7, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class7 = dplyr::select(tcga_class7, -c("N","se", "ci"))
tcga_class7 = reshape(tcga_class7,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class7$Model = "SVM Elastic Net"
remove(total_list)


#NNET lasso
total_list <- mget(ls(pattern = 'nnet.lasso\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class8 = melt(total_list)
tcga_class8 = summarySE(tcga_class8, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class8 = dplyr::select(tcga_class8, -c("N","se", "ci"))
tcga_class8 = reshape(tcga_class8,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class8$Model = "NNET Elastic Net"
remove(total_list)
```




#GBM compile
```{r}
#GBM feature selection
total_list <- mget(ls(pattern = 'gbm.feature\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class9 = melt(total_list)
tcga_class9 = summarySE(tcga_class9, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class9 = dplyr::select(tcga_class9, -c("N","se", "ci"))
tcga_class9 = reshape(tcga_class9,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class9$Model = "Full GBM"
remove(total_list)

#Lasso GBM selection
total_list <- mget(ls(pattern = 'lasso.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class10 = melt(total_list)
tcga_class10 = summarySE(tcga_class10, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class10 = dplyr::select(tcga_class10, -c("N","se", "ci"))
tcga_class10 = reshape(tcga_class10,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class10$Model = "Elastic Net GBM"
remove(total_list)

#NB GBM
total_list <- mget(ls(pattern = 'nb.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class11 = melt(total_list)
tcga_class11 = summarySE(tcga_class11, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class11 = dplyr::select(tcga_class11, -c("N","se", "ci"))
tcga_class11 = reshape(tcga_class11,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class11$Model = "NB GBM"
remove(total_list)

#RF GBM
total_list <- mget(ls(pattern = 'rf.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class12 = melt(total_list)
tcga_class12 = summarySE(tcga_class12, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class12 = dplyr::select(tcga_class12, -c("N","se", "ci"))
tcga_class12 = reshape(tcga_class12,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class12$Model = "RF GBM"
remove(total_list)

#GBM GBM
total_list <- mget(ls(pattern = 'gbm.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class13 = melt(total_list)
tcga_class13 = summarySE(tcga_class13, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class13 = dplyr::select(tcga_class13, -c("N","se", "ci"))
tcga_class13 = reshape(tcga_class13,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class13$Model = "GBM GBM"
remove(total_list)

#KNN GBM
total_list <- mget(ls(pattern = 'knn.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class14 = melt(total_list)
tcga_class14 = summarySE(tcga_class14, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class14 = dplyr::select(tcga_class14, -c("N","se", "ci"))
tcga_class14 = reshape(tcga_class14,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class14$Model = "KNN GBM"
remove(total_list)

#SVM GBM
total_list <- mget(ls(pattern = 'svm.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class15 = melt(total_list)
tcga_class15 = summarySE(tcga_class15, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class15 = dplyr::select(tcga_class15, -c("N","se", "ci"))
tcga_class15 = reshape(tcga_class15,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class15$Model = "SVM GBM"
remove(total_list)

#NNET GBM
total_list <- mget(ls(pattern = 'nnet.gbm\\d+'))
total_list <- lapply(total_list, '[','byClass')
total_list = total_list[-c(1:10)]
tcga_class16 = melt(total_list)
tcga_class16 = summarySE(tcga_class16, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class16 = dplyr::select(tcga_class16, -c("N","se", "ci"))
tcga_class16 = reshape(tcga_class16,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class16$Model = "NNET GBM"
remove(total_list)

```
#SVM compile
```{r}
#SVM feature selection
total_list <- lapply(mget(ls(pattern = 'full.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class17 = melt(total_list)
tcga_class17 = summarySE(tcga_class17, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class17 = dplyr::select(tcga_class17, -c("N","se", "ci"))
tcga_class17 = reshape(tcga_class17,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class17$Model = "Full SVM"
remove(total_list)

#Lasso SVM selection
total_list <- lapply(mget(ls(pattern = 'lasso.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class18 = melt(total_list)
tcga_class18 = summarySE(tcga_class18, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class18 = dplyr::select(tcga_class18, -c("N","se", "ci"))
tcga_class18 = reshape(tcga_class18,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class18$Model = "Elastic Net SVM"
remove(total_list)

#NB SVM
total_list <- lapply(mget(ls(pattern = 'nb.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class19 = melt(total_list)
tcga_class19 = summarySE(tcga_class19, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class19 = dplyr::select(tcga_class19, -c("N","se", "ci"))
tcga_class19 = reshape(tcga_class19,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class19$Model = "NB SVM"
remove(total_list)

#RF SVM
total_list <- lapply(mget(ls(pattern = 'rf.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class20 = melt(total_list)
tcga_class20 = summarySE(tcga_class20, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class20 = dplyr::select(tcga_class20, -c("N","se", "ci"))
tcga_class20 = reshape(tcga_class20,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class20$Model = "RF SVM"
remove(total_list)


#GBM SVM
total_list <- lapply(mget(ls(pattern = 'gbm.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class21 = melt(total_list)
tcga_class21 = summarySE(tcga_class21, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class21 = dplyr::select(tcga_class21, -c("N","se", "ci"))
tcga_class21 = reshape(tcga_class21,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class21$Model = "GBM SVM"
remove(total_list)

#KNN SVM
total_list <- lapply(mget(ls(pattern = 'knn.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class22 = melt(total_list)
tcga_class22 = summarySE(tcga_class22, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class22 = dplyr::select(tcga_class22, -c("N","se", "ci"))
tcga_class22 = reshape(tcga_class22,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class22$Model = "KNN SVM"
remove(total_list)

#SVM SVM
total_list <- lapply(mget(ls(pattern = 'svm.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class23 = melt(total_list)
tcga_class23 = summarySE(tcga_class23, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class23 = dplyr::select(tcga_class23, -c("N","se", "ci"))
tcga_class23 = reshape(tcga_class23,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class23$Model = "SVM SVM"
remove(total_list)

#NNET GBM
total_list <- lapply(mget(ls(pattern = 'nnet.svm.TCGA\\d+')), function(x) {
         data <- x$byClass})
tcga_class24 = melt(total_list)
tcga_class24 = summarySE(tcga_class24, measurevar=c("value") , groupvars=c("Var1", "Var2"))
tcga_class24 = dplyr::select(tcga_class24, -c("N","se", "ci"))
tcga_class24 = reshape(tcga_class24,
           idvar = "Var1",
           timevar = "Var2",
           direction = "wide")
tcga_class24$Model = "NNET SVM"
remove(total_list)
```

```{r}
total_list <- mget(ls(pattern = 'tcga_class\\d+'))
compile_tcga_class = do.call(rbind, total_list)
```

#Export data dataframe
```{r}
write.csv(compile_tcga_class,file = "compile_tcga_class.csv")
```

